<!doctype html><html lang=zh-cn>
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<meta charset=utf-8>
<meta name=generator content="Hugo 0.88.1"><meta name=theme-color content="#16171d">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=format-detection content="telephone=no, date=no, address=no, email=no">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<title>MIT6.828 | Hw-3: Shell 【待填坑】 | The Daily Awesome</title>
<link rel=stylesheet href=/css/meme.min.c7b66d8ab937ea5489e87c6d96c470e3f5e7b5a21a385e18c358b7b3be61b6de.css>
<script src=/js/meme.min.8cbe976441b5181abfd3093c9beee209b19cdbb1fa77c48d225a83ba81fa3fb1.js></script>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link rel=stylesheet href="https://fonts.loli.net/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap" media=print onload="this.media='all'">
<noscript><link rel=stylesheet href="https://fonts.loli.net/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap"></noscript>
<meta name=author content="Jiachen Zhang"><meta name=description content="LINK 这节课主要通过完善给出的代码实现简单的 shell Read Chapter 0 of the xv6 book. 下载代码：wget https://pdos.csail.mit.edu/6.828/2018/homework/sh.c 创建包含以下命令的 t.sh 文件 1 2 3 4 5 6 7 ls > y cat < y | sort | uniq | wc > y1 cat y1 rm y1 ls | sort | uniq | wc rm y 编译 sh.c: gcc sh.c 生成 a.out 运行脚本：./a.out < t.sh 1 2 3 4 5 6 7 8 redir not implemented exec not implemented pipe not implemented exec not implemented exec not implemented pipe not implemented exec not implemented 接下来是 shell 命令的实现。 1. Executing simple commands……">
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<link rel=mask-icon href=/icons/safari-pinned-tab.svg color=#2a6df4>
<link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png>
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-title content="The Daily Awesome">
<meta name=apple-mobile-web-app-status-bar-style content="black">
<meta name=mobile-web-app-capable content="yes">
<meta name=application-name content="The Daily Awesome">
<meta name=msapplication-starturl content="../">
<meta name=msapplication-TileColor content="#fff">
<meta name=msapplication-TileImage content="../icons/mstile-150x150.png">
<link rel=manifest href=/manifest.json>
<link rel=canonical href=https://www.zhangjc.site/archives-572/>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2019-06-17T20:10:00+00:00","dateModified":"2021-10-01T20:54:44+08:00","url":"https://www.zhangjc.site/archives-572/","headline":"MIT6.828 | Hw-3: Shell 【待填坑】","description":"LINK 这节课主要通过完善给出的代码实现简单的 shell Read Chapter 0 of the xv6 book. 下载代码：wget https://pdos.csail.mit.edu/6.828/2018/homework/sh.c 创建包含以下命令的 t.sh 文件 1 2 3 4 5 6 7 ls \u003e y cat \u003c y | sort | uniq | wc \u003e y1 cat y1 rm y1 ls | sort | uniq | wc rm y 编译 sh.c: gcc sh.c 生成 a.out 运行脚本：./a.out \u003c t.sh 1 2 3 4 5 6 7 8 redir not implemented exec not implemented pipe not implemented exec not implemented exec not implemented pipe not implemented exec not implemented 接下来是 shell 命令的实现。 1. Executing simple commands……","inLanguage":"zh-CN","articleSection":"tech","wordCount":784,"image":"https://www.zhangjc.site/icons/apple-touch-icon.png","author":{"@type":"Person","description":"The Daily Awesome","email":"zhangjc1999@gmail.com","image":"https://www.zhangjc.site/icons/apple-touch-icon.png","url":"https://www.zhangjc.site/","name":"Jiachen"},"license":"[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)","publisher":{"@type":"Organization","name":"The Daily Awesome","logo":{"@type":"ImageObject","url":"https://www.zhangjc.site/icons/apple-touch-icon.png"},"url":"https://www.zhangjc.site/"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://www.zhangjc.site/"}}</script>
<meta name=twitter:card content="summary">
<meta name=twitter:site content="@JiachenZhang5">
<meta name=twitter:creator content="@JiachenZhang5">
<meta property="og:title" content="MIT6.828 | Hw-3: Shell 【待填坑】">
<meta property="og:description" content="LINK 这节课主要通过完善给出的代码实现简单的 shell Read Chapter 0 of the xv6 book. 下载代码：wget https://pdos.csail.mit.edu/6.828/2018/homework/sh.c 创建包含以下命令的 t.sh 文件 1 2 3 4 5 6 7 ls > y cat < y | sort | uniq | wc > y1 cat y1 rm y1 ls | sort | uniq | wc rm y 编译 sh.c: gcc sh.c 生成 a.out 运行脚本：./a.out < t.sh 1 2 3 4 5 6 7 8 redir not implemented exec not implemented pipe not implemented exec not implemented exec not implemented pipe not implemented exec not implemented 接下来是 shell 命令的实现。 1. Executing simple commands……">
<meta property="og:url" content="https://www.zhangjc.site/archives-572/">
<meta property="og:site_name" content="The Daily Awesome">
<meta property="og:locale" content="zh"><meta property="og:image" content="https://www.zhangjc.site/icons/apple-touch-icon.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-06-17T20:10:00+00:00">
<meta property="article:modified_time" content="2021-10-01T20:54:44+08:00">
<meta property="article:section" content="tech">
<script type=text/javascript src="https://s4.cnzz.com/z_stat.php?id=1279769355&web_id=1279769355"></script>
</head>
<body>
<div class=container>
<header class=header>
<div class=header-wrapper>
<div class="header-inner single">
<div class=site-brand>
<a href=/ class=brand>The Daily Awesome</a>
</div>
<nav class=nav>
<ul class=menu id=menu>
<li class=menu-item><a href=/life/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon archive"><path d="M32 448c0 17.7 14.3 32 32 32h384c17.7.0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6.0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6.0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3.0 64v48c0 8.8 7.2 16 16 16h480c8.8.0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"/></svg><span class=menu-item-name>生活</span></a>
</li>
<li class=menu-item><a href=/tech/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon th"><path d="M149.333 56v80c0 13.255-10.745 24-24 24H24c-13.255.0-24-10.745-24-24V56c0-13.255 10.745-24 24-24h101.333c13.255.0 24 10.745 24 24zm181.334 240v-80c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256.0 24.001-10.745 24.001-24zm32-240v80c0 13.255 10.745 24 24 24H488c13.255.0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24zm-32 80V56c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256.0 24.001-10.745 24.001-24zm-205.334 56H24c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24zM0 376v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H24c-13.255.0-24 10.745-24 24zm386.667-56H488c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zm0 160H488c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zM181.333 376v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24z"/></svg><span class=menu-item-name>技术</span></a>
</li>
<li class=menu-item><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon user-circle"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6.0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7.0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4.0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9s28-2.7 40.9-6.9c2.3-.7 4.7-1.1 7.1-1.1 42.9.0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg><span class=menu-item-name>关于</span></a>
</li>
<li class=menu-item>
<a id=theme-switcher href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-light"><path d="M193.2 104.5 242 7a18 18 0 0128 0l48.8 97.5L422.2 70A18 18 0 01442 89.8l-34.5 103.4L505 242a18 18 0 010 28l-97.5 48.8L442 422.2A18 18 0 01422.2 442l-103.4-34.5L270 505a18 18 0 01-28 0l-48.8-97.5L89.8 442A18 18 0 0170 422.2l34.5-103.4-97.5-48.8a18 18 0 010-28l97.5-48.8L70 89.8A18 18 0 0189.8 70zM256 128a128 128 0 10.01.0M256 160a96 96 0 10.01.0"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-dark"><path d="M27 412A256 256 0 10181 5a11.5 11.5.0 00-5 20A201.5 201.5.0 0142 399a11.5 11.5.0 00-15 13"/></svg></a>
</li>
</ul>
</nav>
</div>
</div>
<input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label>
<label for=nav-toggle class=nav-curtain></label>
</header>
<main class="main single" id=main>
<div class=main-inner>
<article class="content post h-entry" data-align=justify data-type=tech data-toc-num=true>
<h1 class="post-title p-name">MIT6.828 | Hw-3: Shell 【待填坑】</h1>
<div class=post-meta>
<time datetime=2019-06-17T20:10:00+00:00 class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6.0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h48c26.5.0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3.0 6-2.7 6-6z"/></svg>&nbsp;2019.6.17</time>
<span class="post-meta-item category"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>&nbsp;<a href=/tech/ class="category-link p-category">Tech</a></span>
</div>
<nav class=contents>
<ol class=toc>
<li><a id=contents:1-executing-simple-commands href=#1-executing-simple-commands>1. Executing simple commands</a></li>
<li><a id=contents:2-io-redirection href=#2-io-redirection>2. I/O redirection</a></li>
<li><a id=contents:3-implement-pipes href=#3-implement-pipes>3. Implement pipes</a></li>
<li><a id=contents:4-optional-challenge-exercises待填坑 href=#4-optional-challenge-exercises待填坑>4. Optional challenge exercises【待填坑】</a></li>
</ol>
</nav><div class="post-body e-content">
<p><a href=https://pdos.csail.mit.edu/6.828/2018/homework/xv6-shell.html target=_blank rel=noopener>LINK</a></p>
<p>这节课主要通过完善给出的代码实现简单的 <code>shell</code></p>
<p>Read Chapter 0 of the <a href=https://pdos.csail.mit.edu/6.828/2018/xv6/book-rev10.pdf target=_blank rel=noopener>xv6 book</a>.</p>
<p>下载代码：<code>wget https://pdos.csail.mit.edu/6.828/2018/homework/sh.c</code></p>
<p>创建包含以下命令的 <code>t.sh</code> 文件</p>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ls &gt; y
cat &lt; y <span class=p>|</span> sort <span class=p>|</span> uniq <span class=p>|</span> wc &gt; y1
cat y1
rm y1
ls <span class=p>|</span>  sort <span class=p>|</span> uniq <span class=p>|</span> wc
rm y 

</code></pre></td></tr></table></div>
</div>
</div><p>编译 <code>sh.c</code>: <code>gcc sh.c</code> 生成 <code>a.out</code></p>
<p>运行脚本：<code>./a.out &lt; t.sh</code></p>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>redir not implemented 
<span class=nb>exec</span> not implemented 
pipe not implemented 
<span class=nb>exec</span> not implemented 
<span class=nb>exec</span> not implemented 
pipe not implemented
<span class=nb>exec</span> not implemented

</code></pre></td></tr></table></div>
</div>
</div><p>接下来是 <code>shell</code> 命令的实现。</p>
<h2 id=1-executing-simple-commands><a href=#1-executing-simple-commands class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:1-executing-simple-commands class=headings>1. Executing simple commands</a></h2>
<p>实现简单的命令 <code>ls</code>，能够列出当前目录的文件。</p>
<p>终端键入<code>man 3 exec</code>， 查看手册，可以看到如下：</p>
<pre tabindex=0><code>The execv(), execvp(), and execvpe() functions provide an array of pointers to null-terminated strings that represent the argument list available to the new program.  The first argument, by convention, should point to the filename associated with the file being executed. The array of pointers must be terminated by a null pointer.

</code></pre><p>具体实现：</p>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c>  <span class=k>case</span> <span class=sc>&#39; &#39;</span><span class=o>:</span>
    <span class=n>ecmd</span> <span class=o>=</span> <span class=p>(</span><span class=k>struct</span> <span class=n>execcmd</span><span class=o>*</span><span class=p>)</span><span class=n>cmd</span><span class=p>;</span>
    <span class=k>if</span><span class=p>(</span><span class=n>ecmd</span><span class=o>-&gt;</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
      <span class=n>_exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
    <span class=c1>// fprintf(stderr, &#34;exec not implemented\n&#34;);    
</span><span class=c1></span>    <span class=c1>// Your code here ...
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>access</span><span class=p>(</span><span class=n>ecmd</span><span class=o>-&gt;</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>F_OK</span><span class=p>))</span>   <span class=c1>//cmd exists in current directory
</span><span class=c1></span>      <span class=n>execv</span><span class=p>(</span><span class=n>ecmd</span><span class=o>-&gt;</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>ecmd</span><span class=o>-&gt;</span><span class=n>argv</span><span class=p>);</span>
    <span class=k>else</span> <span class=p>{</span>  <span class=c1>//cmd exists in current directory, run /bin/&lt;cmd&gt;
</span><span class=c1></span>      <span class=n>strcpy</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>root</span><span class=p>);</span>         <span class=c1>// path = &#34;/bin/&#34;
</span><span class=c1></span>      <span class=n>strcat</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>ecmd</span><span class=o>-&gt;</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span><span class=c1>// path = &#34;/bin/&lt;cmd&gt;&#34;
</span><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>access</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>F_OK</span><span class=p>))</span>
            <span class=n>execv</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>ecmd</span><span class=o>-&gt;</span><span class=n>argv</span><span class=p>);</span>
        <span class=k>else</span>
           <span class=nf>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=s>&#34;Command &lt;%s&gt; not found.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>ecmd</span><span class=o>-&gt;</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
    <span class=p>}</span>
    <span class=k>break</span><span class=p>;</span>

</code></pre></td></tr></table></div>
</div>
</div><p>重新编译后运行：</p>
<pre tabindex=0><code>6.828$ ls 
'MIT6.828 Hw-3 Shell.md'   a.out   sh.c   t.sh   tmp 

</code></pre><h2 id=2-io-redirection><a href=#2-io-redirection class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:2-io-redirection class=headings>2. I/O redirection</a></h2>
<p>实现重定向：</p>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nb>echo</span> <span class=s2>&#34;6.828 is cool&#34;</span> &gt; x.txt
cat &lt; x.txt

</code></pre></td></tr></table></div>
</div>
</div><p>添加重定向命令代码：</p>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c>  <span class=k>case</span> <span class=sc>&#39;&gt;&#39;</span><span class=o>:</span>
  <span class=k>case</span> <span class=sc>&#39;&lt;&#39;</span><span class=o>:</span>
    <span class=n>rcmd</span> <span class=o>=</span> <span class=p>(</span><span class=k>struct</span> <span class=n>redircmd</span><span class=o>*</span><span class=p>)</span><span class=n>cmd</span><span class=p>;</span>
    <span class=c1>// fprintf(stderr, &#34;redir not implemented\n&#34;);
</span><span class=c1></span>    <span class=c1>// Your code here ...
</span><span class=c1></span>    <span class=n>close</span><span class=p>(</span><span class=n>rcmd</span><span class=o>-&gt;</span><span class=n>fd</span><span class=p>);</span>  <span class=c1>// close stdin or stdout, which is the default I/O
</span><span class=c1></span>    <span class=c1>// open file with fd 0(write) or 1(read)
</span><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>open</span><span class=p>(</span><span class=n>rcmd</span><span class=o>-&gt;</span><span class=n>file</span><span class=p>,</span> <span class=n>rcmd</span><span class=o>-&gt;</span><span class=n>flags</span><span class=p>,</span> <span class=mo>0777</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=s>&#34;open %s failed!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>rcmd</span><span class=o>-&gt;</span><span class=n>file</span><span class=p>);</span>
      <span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=n>runcmd</span><span class=p>(</span><span class=n>rcmd</span><span class=o>-&gt;</span><span class=n>cmd</span><span class=p>);</span>
    <span class=k>break</span><span class=p>;</span>

</code></pre></td></tr></table></div>
</div>
</div><p>重新编译并运行：</p>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>6.828$ <span class=nb>echo</span> <span class=s2>&#34;6.828 is cool&#34;</span> &gt; x.txt 
6.828$ cat &lt; x.txt 
<span class=s2>&#34;6.828 is cool&#34;</span> 

</code></pre></td></tr></table></div>
</div>
</div><h2 id=3-implement-pipes><a href=#3-implement-pipes class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:3-implement-pipes class=headings>3. Implement pipes</a></h2>
<p>Reference:</p>
<ul>
<li><a href=https://www.geeksforgeeks.org/pipe-system-call/ target=_blank rel=noopener>pipe() System call@GeeksforGeeks</a></li>
<li><a href=/archives/548.html>译 | pipe, fork & dup: 理解命令执行和输入输出流</a></li>
</ul>
<p>参考课本上第13页 <code>pipe</code> 的代码，实现如下：</p>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=k>case</span> <span class=sc>&#39;|&#39;</span><span class=o>:</span>
    <span class=n>pcmd</span> <span class=o>=</span> <span class=p>(</span><span class=k>struct</span> <span class=n>pipecmd</span><span class=o>*</span><span class=p>)</span><span class=n>cmd</span><span class=p>;</span>
    <span class=c1>// fprintf(stderr, &#34;pipe not implemented\n&#34;);
</span><span class=c1></span>    <span class=c1>// Your code here ...
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>pipe</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=s>&#34;create pipe failed!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
      <span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=c1>// using pipe(p) to create a new pipe
</span><span class=c1></span>    <span class=c1>// and record the read and write file descriptor in the array p
</span><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>fork</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>dup2</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>STDOUT_FILENO</span><span class=p>);</span>  <span class=c1>// redirect stdout to p[1] (read end of pipe)
</span><span class=c1></span>      <span class=n>close</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>  <span class=c1>// close stdin cloned by fork
</span><span class=c1></span>      <span class=n>close</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>  <span class=c1>// close stdout cloned by fork
</span><span class=c1></span>      <span class=n>runcmd</span><span class=p>(</span><span class=n>pcmd</span><span class=o>-&gt;</span><span class=n>left</span><span class=p>);</span>         <span class=c1>// child process for left cmd
</span><span class=c1></span>    <span class=p>}</span>
    <span class=k>if</span><span class=p>(</span><span class=n>fork</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>dup2</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>STDIN_FILENO</span><span class=p>);</span>   <span class=c1>// redirect stdin to p[0] (out end of pipe)
</span><span class=c1></span>      <span class=n>close</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>  <span class=c1>// close stdin cloned by fork
</span><span class=c1></span>      <span class=n>close</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>  <span class=c1>// close stdout cloned by fork
</span><span class=c1></span>      <span class=n>runcmd</span><span class=p>(</span><span class=n>pcmd</span><span class=o>-&gt;</span><span class=n>right</span><span class=p>);</span>        <span class=c1>// child process for right cmd
</span><span class=c1></span>    <span class=p>}</span>
    <span class=n>close</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
    <span class=n>close</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
    <span class=n>wait</span><span class=p>(</span><span class=o>&amp;</span><span class=n>r</span><span class=p>);</span>
    <span class=n>wait</span><span class=p>(</span><span class=o>&amp;</span><span class=n>r</span><span class=p>);</span>
    <span class=k>break</span><span class=p>;</span>  
  <span class=p>}</span>    
  <span class=n>_exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>

</code></pre></td></tr></table></div>
</div>
</div><p>重新编译后运行：</p>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>6.828$ ls <span class=p>|</span> sort 
MIT6.828 Hw-3 Shell.md 
a.out
sh.c
t.sh
tmp
x.txt

</code></pre></td></tr></table></div>
</div>
</div><h2 id=4-optional-challenge-exercises待填坑><a href=#4-optional-challenge-exercises待填坑 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:4-optional-challenge-exercises待填坑 class=headings>4. Optional challenge exercises【待填坑】</a></h2>
<p>The following exercises are entirely optional and won't affect your grade. Add any feature of your choice to your shell, for example:</p>
<ul>
<li>Implement lists of commands, separated by ";"</li>
<li>Implement sub shells by implementing "(" and ")"</li>
<li>Implement running commands in the background by supporting "&" and "wait"</li>
</ul>
<p>All of these require making changes to the parser and the <code>runcmd</code> function.</p>
</div>
</article>
<div class=related-posts>
<h2 class=related-title>相关文章：<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6.0-12-5.4-12-12v-92h-92c-6.6.0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6.0 12 5.4 12 12v92h92c6.6.0 12 5.4 12 12v56z"/></svg></h2>
<ul class=related-list>
<li class=related-item>
<a href=/archives-604/ class=related-link>MIT6.828 | Lec6: Virtual Memory - 1</a>
</li>
<li class=related-item>
<a href=/archives-602/ class=related-link>MIT6.828 | hw5: xv6 system calls 【待填坑 dup2】</a>
</li>
<li class=related-item>
<a href=/archives-601/ class=related-link>MIT6.828 | Lec 5: Isolation mechanisms</a>
</li>
<li class=related-item>
<a href=/archives-592/ class=related-link>MIT6.828 | Lec4: Shell & OS organization</a>
</li>
<li class=related-item>
<a href=/archives-579/ class=related-link>MIT6.828 | Lab 2: Memory Management</a>
</li>
</ul>
</div>
<div class=post-tags>
<a href=/tags/note/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>note</a>
<a href=/tags/mit6.828/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>MIT6.828</a>
</div>
<footer class=minimal-footer>
<div class=post-tag><a href=/tags/note/ rel=tag class=post-tag-link>#note</a> <a href=/tags/mit6.828/ rel=tag class=post-tag-link>#mit6828</a></div>
<div class=post-category>
<a href=/tech/ class="post-category-link active">tech</a>
</div>
</footer>
<ul class=post-nav>
<li class=post-nav-prev>
<a href=/archives-574/ rel=prev>&lt; 译 | 5.2 页面翻译 - Page Translation</a>
</li>
<li class=post-nav-next>
<a href=/archives-548/ rel=next>译 | pipe, fork & dup: 理解命令执行和输入输出流 ></a>
</li>
</ul>
</div>
</main>
<div id=back-to-top class=back-to-top>
<a href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a>
</div>
<footer id=footer class=footer>
<div class=footer-inner>
<div class=site-info>©&nbsp;2019–2021&nbsp;&nbsp;Jiachen</div><div class=site-copyright><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a></div>
</div>
</footer>
</div>
<script>'serviceWorker'in navigator&&window.addEventListener('load',function(){navigator.serviceWorker.register('/sw.js')})</script>
<script src=https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js></script>
<script>mediumZoom(document.querySelectorAll('div.post-body img'),{background:'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'})</script>
<script src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js type=module defer></script>
</body>
</html>
<!doctype html><html lang=zh-cn>
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<meta charset=utf-8>
<meta name=generator content="Hugo 0.88.1"><meta name=theme-color content="#16171d">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=format-detection content="telephone=no, date=no, address=no, email=no">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<title>Project | 单周期CPU报告 | The Daily Awesome</title>
<link rel=stylesheet href=/css/meme.min.c7b66d8ab937ea5489e87c6d96c470e3f5e7b5a21a385e18c358b7b3be61b6de.css>
<script src=/js/meme.min.8cbe976441b5181abfd3093c9beee209b19cdbb1fa77c48d225a83ba81fa3fb1.js></script>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link rel=stylesheet href="https://fonts.loli.net/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap" media=print onload="this.media='all'">
<noscript><link rel=stylesheet href="https://fonts.loli.net/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap"></noscript>
<meta name=author content="Jiachen Zhang"><meta name=description content="一、 实验目的 ​ 利用verilog和FPGA实现单周期CPU 二、 实验内容 译码单元 根据pc值读取指定内存地址的指令信息 按照汇编指令组成规则，对原始指令进行分解 实现寄存器的读写操作 设计执行单元： 确定执行单元的功能及输入、输出端口 运算数的选择 运算功能的实现 通过组合码实现对运算的控制 运算 算术运算(Arithm……">
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<link rel=mask-icon href=/icons/safari-pinned-tab.svg color=#2a6df4>
<link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png>
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-title content="The Daily Awesome">
<meta name=apple-mobile-web-app-status-bar-style content="black">
<meta name=mobile-web-app-capable content="yes">
<meta name=application-name content="The Daily Awesome">
<meta name=msapplication-starturl content="../">
<meta name=msapplication-TileColor content="#fff">
<meta name=msapplication-TileImage content="../icons/mstile-150x150.png">
<link rel=manifest href=/manifest.json>
<link rel=canonical href=https://www.zhangjc.site/archives-476/>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2019-06-11T04:47:00+00:00","dateModified":"2021-10-01T20:54:44+08:00","url":"https://www.zhangjc.site/archives-476/","headline":"Project | 单周期CPU报告","description":"一、 实验目的 ​ 利用verilog和FPGA实现单周期CPU 二、 实验内容 译码单元 根据pc值读取指定内存地址的指令信息 按照汇编指令组成规则，对原始指令进行分解 实现寄存器的读写操作 设计执行单元： 确定执行单元的功能及输入、输出端口 运算数的选择 运算功能的实现 通过组合码实现对运算的控制 运算 算术运算(Arithm……","inLanguage":"zh-CN","articleSection":"tech","wordCount":8205,"image":["https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/1266277654.png","https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/741474208.png","https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/1462022838.png","https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/3279812433.png","https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/474079374.png","https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/998898828.png","https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/2745532257.png","https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/2098947473.png","https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/942749760.png"],"author":{"@type":"Person","description":"The Daily Awesome","email":"zhangjc1999@gmail.com","image":"https://www.zhangjc.site/icons/apple-touch-icon.png","url":"https://www.zhangjc.site/","name":"Jiachen"},"license":"[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)","publisher":{"@type":"Organization","name":"The Daily Awesome","logo":{"@type":"ImageObject","url":"https://www.zhangjc.site/icons/apple-touch-icon.png"},"url":"https://www.zhangjc.site/"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://www.zhangjc.site/"}}</script>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:site content="@JiachenZhang5">
<meta name=twitter:creator content="@JiachenZhang5">
<meta property="og:title" content="Project | 单周期CPU报告">
<meta property="og:description" content="一、 实验目的 ​ 利用verilog和FPGA实现单周期CPU 二、 实验内容 译码单元 根据pc值读取指定内存地址的指令信息 按照汇编指令组成规则，对原始指令进行分解 实现寄存器的读写操作 设计执行单元： 确定执行单元的功能及输入、输出端口 运算数的选择 运算功能的实现 通过组合码实现对运算的控制 运算 算术运算(Arithm……">
<meta property="og:url" content="https://www.zhangjc.site/archives-476/">
<meta property="og:site_name" content="The Daily Awesome">
<meta property="og:locale" content="zh"><meta property="og:image" content="https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/1266277654.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-06-11T04:47:00+00:00">
<meta property="article:modified_time" content="2021-10-01T20:54:44+08:00">
<meta property="article:section" content="tech">
<script type=text/javascript src="https://s4.cnzz.com/z_stat.php?id=1279769355&web_id=1279769355"></script>
</head>
<body>
<div class=container>
<header class=header>
<div class=header-wrapper>
<div class="header-inner single">
<div class=site-brand>
<a href=/ class=brand>The Daily Awesome</a>
</div>
<nav class=nav>
<ul class=menu id=menu>
<li class=menu-item><a href=/life/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon archive"><path d="M32 448c0 17.7 14.3 32 32 32h384c17.7.0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6.0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6.0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3.0 64v48c0 8.8 7.2 16 16 16h480c8.8.0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"/></svg><span class=menu-item-name>生活</span></a>
</li>
<li class=menu-item><a href=/tech/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon th"><path d="M149.333 56v80c0 13.255-10.745 24-24 24H24c-13.255.0-24-10.745-24-24V56c0-13.255 10.745-24 24-24h101.333c13.255.0 24 10.745 24 24zm181.334 240v-80c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256.0 24.001-10.745 24.001-24zm32-240v80c0 13.255 10.745 24 24 24H488c13.255.0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24zm-32 80V56c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256.0 24.001-10.745 24.001-24zm-205.334 56H24c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24zM0 376v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H24c-13.255.0-24 10.745-24 24zm386.667-56H488c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zm0 160H488c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zM181.333 376v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24z"/></svg><span class=menu-item-name>技术</span></a>
</li>
<li class=menu-item><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon user-circle"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6.0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7.0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4.0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9s28-2.7 40.9-6.9c2.3-.7 4.7-1.1 7.1-1.1 42.9.0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg><span class=menu-item-name>关于</span></a>
</li>
<li class=menu-item>
<a id=theme-switcher href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-light"><path d="M193.2 104.5 242 7a18 18 0 0128 0l48.8 97.5L422.2 70A18 18 0 01442 89.8l-34.5 103.4L505 242a18 18 0 010 28l-97.5 48.8L442 422.2A18 18 0 01422.2 442l-103.4-34.5L270 505a18 18 0 01-28 0l-48.8-97.5L89.8 442A18 18 0 0170 422.2l34.5-103.4-97.5-48.8a18 18 0 010-28l97.5-48.8L70 89.8A18 18 0 0189.8 70zM256 128a128 128 0 10.01.0M256 160a96 96 0 10.01.0"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-dark"><path d="M27 412A256 256 0 10181 5a11.5 11.5.0 00-5 20A201.5 201.5.0 0142 399a11.5 11.5.0 00-15 13"/></svg></a>
</li>
</ul>
</nav>
</div>
</div>
<input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label>
<label for=nav-toggle class=nav-curtain></label>
</header>
<main class="main single" id=main>
<div class=main-inner>
<article class="content post h-entry" data-align=justify data-type=tech data-toc-num=true>
<h1 class="post-title p-name">Project | 单周期CPU报告</h1>
<div class=post-meta>
<time datetime=2019-06-11T04:47:00+00:00 class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6.0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h48c26.5.0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3.0 6-2.7 6-6z"/></svg>&nbsp;2019.6.11</time>
<span class="post-meta-item category"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>&nbsp;<a href=/tech/ class="category-link p-category">Tech</a></span>
</div>
<nav class=contents>
<ol class=toc>
<li><a id=contents:一-实验目的 href=#一-实验目的>一、 实验目的</a></li>
<li><a id=contents:二-实验内容 href=#二-实验内容>二、 实验内容</a></li>
<li><a id=contents:三-实验步骤 href=#三-实验步骤>三、 实验步骤</a>
<ol>
<li><a id=contents:除法器 href=#除法器>除法器</a></li>
<li><a id=contents:乘法器 href=#乘法器>乘法器</a></li>
<li><a id=contents:alu href=#alu>ALU</a></li>
<li><a id=contents:decoder href=#decoder>Decoder</a></li>
<li><a id=contents:执行单元 href=#执行单元>执行单元</a></li>
<li><a id=contents:取指单元 href=#取指单元>取指单元</a></li>
<li><a id=contents:控制单元 href=#控制单元>控制单元</a></li>
<li><a id=contents:memoryio href=#memoryio>MemoryIO</a></li>
<li><a id=contents:cpu href=#cpu>CPU</a></li>
</ol>
</li>
<li><a id=contents:四-实验结果截图并配以适当的文字说明 href=#四-实验结果截图并配以适当的文字说明>四、 实验结果（截图并配以适当的文字说明）</a>
<ol>
<li><a id=contents:除法器-1 href=#除法器-1>除法器</a></li>
<li><a id=contents:乘法器-1 href=#乘法器-1>乘法器</a></li>
<li><a id=contents:alu-1 href=#alu-1>ALU</a></li>
<li><a id=contents:decoder-1 href=#decoder-1>Decoder</a></li>
<li><a id=contents:执行单元-1 href=#执行单元-1>执行单元</a></li>
<li><a id=contents:取指单元-1 href=#取指单元-1>取指单元</a></li>
<li><a id=contents:控制单元-1 href=#控制单元-1>控制单元</a></li>
<li><a id=contents:memoryio-1 href=#memoryio-1>MemoryIO</a></li>
<li><a id=contents:cpu-1 href=#cpu-1>CPU</a></li>
</ol>
</li>
<li><a id=contents:五-实验分析遇到的问题以及解决方案 href=#五-实验分析遇到的问题以及解决方案>五、 实验分析（遇到的问题以及解决方案）</a></li>
<li><a id=contents:六-实验小结与反馈 href=#六-实验小结与反馈>六、 实验小结与反馈</a></li>
</ol>
</nav><div class="post-body e-content">
<h2 id=一-实验目的><a href=#一-实验目的 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:一-实验目的 class=headings>一、 实验目的</a></h2>
<p>​ 利用<code>verilog</code>和<code>FPGA</code>实现单周期<code>CPU</code></p>
<h2 id=二-实验内容><a href=#二-实验内容 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:二-实验内容 class=headings>二、 实验内容</a></h2>
<ol>
<li>译码单元</li>
<li>根据pc值读取指定内存地址的指令信息</li>
<li>按照汇编指令组成规则，对原始指令进行分解</li>
<li>实现寄存器的读写操作</li>
<li>设计执行单元：</li>
<li>确定执行单元的功能及输入、输出端口</li>
<li>运算数的选择</li>
<li>运算功能的实现</li>
</ol>
<ul>
<li>通过组合码实现对运算的控制</li>
<li>运算</li>
<li>算术运算(Arithmetic)，逻辑运算(Logic)</li>
<li>移位运算(Shift)</li>
<li>特殊运算(<code>slt</code>, <code>lui</code>等)</li>
</ul>
<ol>
<li>根据操作码执行指定功能，获取最终运算结果作为输出</li>
<li>取址单元</li>
<li>定义指令 ROM 存储器</li>
<li>从指令 ROM 中获取指令</li>
<li>对 PC 值进行 +4 处理</li>
<li>完成几种跳转指令的PC修改功能</li>
<li>最终修改PC值</li>
<li>控制单元</li>
<li>结合对CPU的理解，分析每条指令在数据通路的执行过程和涉及到的控制信号的取值</li>
<li>根据指令与控制信号的关系，得到每个控制信号与指令的逻辑表达式</li>
<li>存储单元</li>
<li>定义数据存储单元 RAM</li>
<li>实现对数据存储器的读写操作</li>
<li>I/O单元</li>
<li>指定10根IO端口线，其中</li>
<li>LED的片选信号为 ledCtrl</li>
<li>拨码开关的片选信号为 switchCtrl</li>
<li>考虑CPU外设的可拓展性（如多个IO接口单元），通过ioread模块实现多路输入数据的选择</li>
<li>辅助模块</li>
<li>乘法器</li>
<li>除法器</li>
</ol>
<h2 id=三-实验步骤><a href=#三-实验步骤 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:三-实验步骤 class=headings>三、 实验步骤</a></h2>
<h3 id=除法器><a href=#除法器 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:除法器 class=headings>除法器</a></h3>
<p>不保留余数，需要多个时钟周期才能完成操作</p>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=k>module</span> <span class=n>div</span> <span class=p>#(</span><span class=k>parameter</span> <span class=n>WIDTH</span> <span class=o>=</span> <span class=mh>8</span><span class=p>)(</span>
    <span class=k>input</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>a</span><span class=p>,</span> <span class=c1>// ������
</span><span class=c1></span>    <span class=k>input</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>b</span><span class=p>,</span> <span class=c1>// ����
</span><span class=c1></span>    <span class=k>input</span> <span class=n>clk</span><span class=p>,</span>
    <span class=k>input</span> <span class=n>start</span><span class=p>,</span>
    <span class=k>input</span> <span class=n>resetn</span><span class=p>,</span> 
    <span class=k>output</span> <span class=kt>reg</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>  <span class=n>q</span><span class=p>,</span> <span class=c1>//    ��
</span><span class=c1></span>    <span class=k>output</span> <span class=kt>reg</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>r</span><span class=p>,</span> <span class=c1>// ����
</span><span class=c1></span>    <span class=k>output</span> <span class=kt>reg</span> <span class=n>busy</span> <span class=c1>// ����������
</span><span class=c1></span> <span class=p>);</span>   
    <span class=k>integer</span> <span class=n>cnt</span><span class=p>;</span>
    <span class=kt>reg</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>Quotient</span><span class=p>;</span>
    <span class=kt>reg</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>+</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>Divisor</span><span class=p>;</span>
    <span class=kt>reg</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>+</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>Remainder</span><span class=p>;</span>
    <span class=kt>reg</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>+</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>diff</span><span class=p>;</span>
    <span class=kt>reg</span> <span class=n>sign_q</span><span class=p>;</span>
    <span class=k>always</span><span class=p>@(</span><span class=k>posedge</span> <span class=n>clk</span> <span class=k>or</span> <span class=k>negedge</span> <span class=n>resetn</span><span class=p>)</span> <span class=k>begin</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>~</span><span class=n>resetn</span> <span class=o>|</span> <span class=p>(</span><span class=o>~</span><span class=p>(</span><span class=o>|</span><span class=n>b</span><span class=p>)</span> <span class=o>&amp;</span> <span class=n>start</span><span class=p>))</span> <span class=k>begin</span> <span class=c1>// resetn �� ���� Ϊ0
</span><span class=c1></span>             <span class=n>Quotient</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
             <span class=n>Divisor</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
             <span class=n>Remainder</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
             <span class=n>busy</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
             <span class=n>q</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
             <span class=n>r</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
        <span class=k>end</span> <span class=k>else</span> <span class=k>begin</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>cnt</span> <span class=o>&gt;</span> <span class=mh>0</span><span class=p>)</span> <span class=k>begin</span>      <span class=c1>// cnt &gt; 0 ���ڼ���
</span><span class=c1></span>            <span class=n>cnt</span> <span class=o>=</span> <span class=n>cnt</span> <span class=o>-</span> <span class=mh>1</span><span class=p>;</span>
            <span class=n>diff</span> <span class=o>=</span> <span class=n>Remainder</span> <span class=o>-</span> <span class=n>Divisor</span><span class=p>;</span>
            <span class=n>Quotient</span> <span class=o>=</span> <span class=n>Quotient</span> <span class=o>&lt;&lt;</span> <span class=mh>1</span><span class=p>;</span>
            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>diff</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>+</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=p>])</span> <span class=k>begin</span>
                <span class=n>Remainder</span> <span class=o>=</span> <span class=n>diff</span><span class=p>;</span>
                <span class=n>Quotient</span><span class=p>[</span><span class=mh>0</span><span class=p>]</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
            <span class=k>end</span>
            <span class=n>Divisor</span> <span class=o>=</span> <span class=n>Divisor</span> <span class=o>&gt;&gt;</span> <span class=mh>1</span><span class=p>;</span>
            <span class=k>end</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=o>~</span><span class=n>busy</span> <span class=o>&amp;</span> <span class=n>start</span><span class=p>)</span> <span class=k>begin</span> <span class=c1>// busy = 0 �� start ��Ч, ���г�ʼ��
</span><span class=c1></span>                <span class=n>busy</span> <span class=o>=</span> <span class=mh>1</span><span class=p>;</span>
                <span class=n>sign_q</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=p>]</span><span class=o>^</span><span class=n>b</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>-</span><span class=mh>1</span><span class=p>];</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=p>])</span> <span class=n>Remainder</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>=</span> <span class=o>~</span><span class=n>a</span> <span class=o>+</span> <span class=mh>1</span><span class=p>;</span> <span class=c1>// -
</span><span class=c1></span>                <span class=k>else</span>            <span class=n>Remainder</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>a</span><span class=p>;</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>-</span><span class=mh>1</span><span class=p>])</span>   <span class=n>Divisor</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>+</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=n>WIDTH</span><span class=p>]</span> <span class=o>=</span> <span class=o>~</span><span class=n>b</span><span class=o>+</span><span class=mh>1</span><span class=p>;</span> <span class=c1>//-   
</span><span class=c1></span>                <span class=k>else</span>                <span class=n>Divisor</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>+</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=n>WIDTH</span><span class=p>]</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span>
                <span class=n>Remainder</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>+</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>:</span> <span class=n>WIDTH</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
                <span class=n>Divisor</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
                <span class=n>Quotient</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
                <span class=n>diff</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
                <span class=n>cnt</span> <span class=o>=</span> <span class=n>WIDTH</span> <span class=o>+</span> <span class=mh>1</span><span class=p>;</span>
            <span class=k>end</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>cnt</span> <span class=o>==</span> <span class=mh>0</span><span class=p>)</span> <span class=k>begin</span> <span class=c1>// cnt = 0 �������
</span><span class=c1></span>                <span class=n>busy</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span> 
                <span class=k>if</span> <span class=p>(</span><span class=n>sign_q</span><span class=p>)</span> <span class=n>q</span> <span class=o>=</span> <span class=o>~</span><span class=n>Quotient</span> <span class=o>+</span> <span class=mh>1</span><span class=p>;</span>
                <span class=k>else</span>        <span class=n>q</span> <span class=o>=</span> <span class=n>Quotient</span><span class=p>;</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=p>])</span> <span class=n>r</span> <span class=o>=</span> <span class=o>~</span><span class=n>Remainder</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span><span class=o>+</span><span class=mh>1</span><span class=p>;</span>
                <span class=k>else</span>            <span class=n>r</span> <span class=o>=</span> <span class=n>Remainder</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>/</span><span class=mh>2</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>
             <span class=k>end</span> 
         <span class=k>end</span>
     <span class=k>end</span>
<span class=k>endmodule</span>

</code></pre></td></tr></table></div>
</div>
</div><h3 id=乘法器><a href=#乘法器 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:乘法器 class=headings>乘法器</a></h3>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=k>module</span> <span class=n>mul</span> <span class=p>#(</span><span class=k>parameter</span> <span class=n>WIDTH</span> <span class=o>=</span> <span class=mh>8</span><span class=p>)</span> <span class=p>(</span>
    <span class=k>input</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>a</span><span class=p>,</span> <span class=c1>// ������
</span><span class=c1></span>    <span class=k>input</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>b</span><span class=p>,</span> <span class=c1>// ����
</span><span class=c1></span>    <span class=k>output</span> <span class=kt>reg</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>*</span><span class=mh>2</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>c</span> <span class=c1>// �˻�
</span><span class=c1></span><span class=p>);</span>
    <span class=k>integer</span> <span class=n>cnt</span><span class=p>;</span> <span class=c1>// ѭ������
</span><span class=c1></span>    <span class=kt>reg</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>A</span><span class=p>,</span><span class=n>B</span><span class=p>;</span> <span class=c1>// ��ű������������Ͳ��ֻ�
</span><span class=c1></span>    <span class=kt>reg</span> <span class=n>sign</span><span class=p>;</span> <span class=c1>// ��λλ
</span><span class=c1></span>    <span class=kt>reg</span> <span class=n>C</span><span class=p>;</span>
    <span class=kt>reg</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>P</span><span class=p>;</span>
    <span class=kt>reg</span> <span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>Y</span><span class=p>;</span>
    <span class=k>always</span> <span class=p>@(</span><span class=o>*</span><span class=p>)</span>
        <span class=k>begin</span>
        <span class=n>A</span> <span class=o>=</span> <span class=n>a</span><span class=p>;</span>
        <span class=n>B</span> <span class=o>=</span> <span class=n>b</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=p>]</span> <span class=o>==</span> <span class=mh>1</span><span class=p>)</span> <span class=c1>// �������Ǹ����Ĵ���
</span><span class=c1></span>            <span class=n>A</span> <span class=o>=</span> <span class=o>~</span><span class=n>A</span> <span class=o>+</span> <span class=mh>1</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=p>]</span> <span class=o>==</span> <span class=mh>1</span><span class=p>)</span> <span class=c1>// �����Ǹ����Ĵ���
</span><span class=c1></span>            <span class=n>B</span> <span class=o>=</span> <span class=o>~</span><span class=n>B</span> <span class=o>+</span> <span class=mh>1</span><span class=p>;</span>
        
        <span class=n>C</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
        <span class=n>P</span> <span class=o>=</span> <span class=p>{</span><span class=n>WIDTH</span><span class=p>{</span><span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>}};</span>
        <span class=n>Y</span> <span class=o>=</span> <span class=n>B</span><span class=p>;</span>
        <span class=k>for</span><span class=p>(</span><span class=n>cnt</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span> <span class=n>cnt</span><span class=o>&lt;</span><span class=n>WIDTH</span><span class=p>;</span> <span class=n>cnt</span><span class=o>=</span><span class=n>cnt</span><span class=o>+</span><span class=mh>1</span><span class=p>)</span> <span class=c1>// ѭ������
</span><span class=c1></span>            <span class=k>begin</span>
            <span class=k>if</span><span class=p>(</span><span class=n>Y</span><span class=p>[</span><span class=mh>0</span><span class=p>]</span> <span class=o>==</span> <span class=mh>1</span><span class=p>)</span>
                <span class=p>{</span><span class=n>C</span><span class=p>,</span> <span class=n>P</span><span class=p>}</span> <span class=o>=</span> <span class=p>{</span><span class=n>C</span><span class=p>,</span> <span class=n>P</span><span class=p>}</span> <span class=o>+</span> <span class=n>A</span><span class=p>;</span> <span class=c1>// ���ֻ�+������
</span><span class=c1></span>            <span class=p>{</span><span class=n>C</span><span class=p>,</span> <span class=n>P</span><span class=p>,</span> <span class=n>Y</span><span class=p>}</span> <span class=o>=</span> <span class=p>{</span><span class=n>C</span><span class=p>,</span> <span class=n>P</span><span class=p>,</span> <span class=n>Y</span><span class=p>}</span> <span class=o>&gt;&gt;</span> <span class=mh>1</span><span class=p>;</span>
            <span class=k>end</span>
        <span class=n>c</span> <span class=o>=</span> <span class=p>{</span><span class=n>P</span><span class=p>,</span> <span class=n>Y</span><span class=p>};</span>
        <span class=n>sign</span> <span class=o>=</span> <span class=n>a</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>b</span><span class=p>[</span><span class=n>WIDTH</span><span class=o>-</span><span class=mh>1</span><span class=p>];</span>
        <span class=c1>// ������ŵĴ���
</span><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>sign</span><span class=p>)</span>
            <span class=n>c</span> <span class=o>=</span> <span class=o>~</span><span class=n>c</span> <span class=o>+</span> <span class=mh>1</span><span class=p>;</span>
        <span class=k>end</span>
<span class=k>endmodule</span>

</code></pre></td></tr></table></div>
</div>
</div><h3 id=alu><a href=#alu class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:alu class=headings>ALU</a></h3>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=k>module</span> <span class=n>ALUx8</span><span class=p>(</span>
    <span class=k>input</span> <span class=p>[</span><span class=mh>3</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>op</span><span class=p>,</span>
    <span class=k>input</span> <span class=p>[</span><span class=mh>7</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>a</span><span class=p>,</span>
    <span class=k>input</span> <span class=p>[</span><span class=mh>7</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>b</span><span class=p>,</span>
    <span class=k>output</span> <span class=kt>reg</span> <span class=p>[</span><span class=mh>7</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>res</span><span class=p>,</span>
    <span class=k>output</span> <span class=n>cf</span><span class=p>,</span>
    <span class=k>output</span> <span class=n>ovf</span><span class=p>,</span>
    <span class=k>output</span> <span class=n>zf</span><span class=p>,</span>
    <span class=k>output</span> <span class=n>sf</span>
    <span class=p>);</span>
    <span class=kt>wire</span> <span class=p>[</span><span class=mh>7</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>add_sub</span><span class=p>;</span>
    <span class=n>addsubx8_wrapper</span> <span class=n>u_1</span><span class=p>(.</span><span class=n>a</span><span class=p>(</span><span class=n>a</span><span class=p>),</span> <span class=p>.</span><span class=n>b</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=p>.</span><span class=n>cf</span><span class=p>(</span><span class=n>cf</span><span class=p>),</span> <span class=p>.</span><span class=n>ovf</span><span class=p>(</span><span class=n>ovf</span><span class=p>),</span> <span class=p>.</span><span class=n>sf</span><span class=p>(</span><span class=n>sf</span><span class=p>),</span> <span class=p>.</span><span class=n>sub</span><span class=p>(</span><span class=n>op</span><span class=p>[</span><span class=mh>0</span><span class=p>]),</span> <span class=p>.</span><span class=n>sum</span><span class=p>(</span><span class=n>add_sub</span><span class=p>),</span> <span class=p>.</span><span class=n>zf</span><span class=p>(</span><span class=n>zf</span><span class=p>));</span>
    <span class=kt>wire</span> <span class=p>[</span><span class=mh>7</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>res_or</span><span class=p>;</span>
    <span class=n>orgatex8_wrapper</span> <span class=n>u_2</span><span class=p>(.</span><span class=n>a</span><span class=p>(</span><span class=n>a</span><span class=p>),</span> <span class=p>.</span><span class=n>b</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=p>.</span><span class=n>q</span><span class=p>(</span><span class=n>res_or</span><span class=p>));</span>
    <span class=kt>wire</span> <span class=p>[</span><span class=mh>7</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>res_and</span><span class=p>;</span>
    <span class=n>andgatex8_wrapper</span> <span class=n>u_3</span><span class=p>(.</span><span class=n>a</span><span class=p>(</span><span class=n>a</span><span class=p>),</span> <span class=p>.</span><span class=n>b</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=p>.</span><span class=n>q</span><span class=p>(</span><span class=n>res_and</span><span class=p>));</span>
    <span class=kt>wire</span> <span class=p>[</span><span class=mh>7</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>res_xor</span><span class=p>;</span>
    <span class=n>xorgatex8_wrapper</span> <span class=n>u_4</span><span class=p>(.</span><span class=n>a</span><span class=p>(</span><span class=n>a</span><span class=p>),</span> <span class=p>.</span><span class=n>b</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=p>.</span><span class=n>q</span><span class=p>(</span><span class=n>res_xor</span><span class=p>));</span>
    <span class=kt>wire</span> <span class=p>[</span><span class=mh>7</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>res_not</span><span class=p>;</span>
    <span class=n>notgatex8_wrapper</span> <span class=n>u_5</span><span class=p>(.</span><span class=n>a</span><span class=p>(</span><span class=n>a</span><span class=p>),</span> <span class=p>.</span><span class=n>c</span><span class=p>(</span><span class=n>res_not</span><span class=p>));</span>
    <span class=k>always</span><span class=p>@</span><span class=o>*</span>
    <span class=k>begin</span>
        <span class=k>if</span><span class=p>(</span><span class=o>~</span><span class=n>op</span><span class=p>[</span><span class=mh>3</span><span class=p>])</span> <span class=c1>// 0xxx
</span><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=o>~</span><span class=n>op</span><span class=p>[</span><span class=mh>2</span><span class=p>])</span>         <span class=n>res</span> <span class=o>=</span> <span class=n>add_sub</span><span class=p>;</span>  <span class=c1>// 00xx add_sub
</span><span class=c1></span>            <span class=k>else</span> <span class=c1>// 01xx
</span><span class=c1></span>                <span class=k>if</span> <span class=p>(</span><span class=o>~</span><span class=n>op</span><span class=p>[</span><span class=mh>1</span><span class=p>])</span> <span class=c1>// 010x
</span><span class=c1></span>                    <span class=k>if</span> <span class=p>(</span><span class=o>~</span><span class=n>op</span><span class=p>[</span><span class=mh>0</span><span class=p>])</span> <span class=n>res</span> <span class=o>=</span> <span class=n>res_or</span><span class=p>;</span>   <span class=c1>// 0101 or
</span><span class=c1></span>                    <span class=k>else</span>        <span class=n>res</span> <span class=o>=</span> <span class=n>res_and</span><span class=p>;</span>  <span class=c1>// 0100 and
</span><span class=c1></span>                <span class=k>else</span>        <span class=c1>// 011x
</span><span class=c1></span>                    <span class=k>if</span> <span class=p>(</span><span class=o>~</span><span class=n>op</span><span class=p>[</span><span class=mh>0</span><span class=p>])</span> <span class=n>res</span> <span class=o>=</span> <span class=n>res_not</span><span class=p>;</span>  <span class=c1>// 0110 not
</span><span class=c1></span>                    <span class=k>else</span>        <span class=n>res</span> <span class=o>=</span> <span class=n>res_xor</span><span class=p>;</span>  <span class=c1>// 0111 xor
</span><span class=c1></span>        <span class=k>else</span> <span class=c1>// 1xxx
</span><span class=c1></span>        <span class=k>begin</span>
            <span class=k>if</span> <span class=p>(</span><span class=o>~</span><span class=n>op</span><span class=p>[</span><span class=mh>1</span><span class=p>])</span> <span class=c1>// 1x0x
</span><span class=c1></span>                <span class=k>if</span> <span class=p>(</span><span class=o>~</span><span class=n>op</span><span class=p>[</span><span class=mh>0</span><span class=p>])</span> <span class=n>res</span> <span class=o>=</span> <span class=n>a</span> <span class=o>&gt;&gt;</span> <span class=n>b</span><span class=p>[</span><span class=mh>2</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>   <span class=c1>// 1x00 srl  b[2:0]
</span><span class=c1></span>                <span class=k>else</span>        <span class=n>res</span> <span class=o>=</span> <span class=p>(</span><span class=n>$signed</span><span class=p>(</span><span class=n>a</span><span class=p>))</span> <span class=o>&gt;&gt;&gt;</span> <span class=n>b</span><span class=p>[</span><span class=mh>2</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>  <span class=c1>// 1x01 sr b[2:0] �������� ���Ƿ���λ
</span><span class=c1></span>            <span class=k>else</span>        <span class=c1>// 1x1x
</span><span class=c1></span>                <span class=k>if</span> <span class=p>(</span><span class=o>~</span><span class=n>op</span><span class=p>[</span><span class=mh>0</span><span class=p>])</span> <span class=n>res</span> <span class=o>=</span> <span class=n>a</span> <span class=o>&lt;&lt;</span> <span class=n>b</span><span class=p>[</span><span class=mh>2</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>  <span class=c1>// 1x1x sll  b[2:0]
</span><span class=c1></span>        <span class=k>end</span>
    <span class=k>end</span>
<span class=k>endmodule</span>

</code></pre></td></tr></table></div>
</div>
</div><h3 id=decoder><a href=#decoder class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:decoder class=headings>Decoder</a></h3>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=k>module</span> <span class=n>decoder</span><span class=p>(</span>
    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>Instruction</span><span class=p>,</span>    <span class=c1>// 取指单元获得的指令
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>read_data</span><span class=p>,</span>      <span class=c1>// 来自 DATA RAM or I/O port 的 数据
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ALU_result</span><span class=p>,</span>     <span class=c1>// 从ALU获取的运算结果，需要拓展立即数到32位
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>opcplus4</span><span class=p>,</span>       <span class=c1>// 来自 取指单元，用于 JAL
</span><span class=c1></span>    <span class=k>input</span> <span class=n>Jal</span><span class=p>,</span>                  <span class=c1>// 来自 控制单元， 说明是 JAL 指令
</span><span class=c1></span>    <span class=k>input</span> <span class=n>RegWrite</span><span class=p>,</span>             <span class=c1>// 来自 控制单元
</span><span class=c1></span>    <span class=k>input</span> <span class=n>MemtoReg</span><span class=p>,</span>             <span class=c1>// 来自 控制单元
</span><span class=c1></span>    <span class=k>input</span> <span class=n>RegDst</span><span class=p>,</span>               <span class=c1>// 来自 控制单元
</span><span class=c1></span>    <span class=k>input</span> <span class=n>clk</span><span class=p>,</span>                  <span class=c1>// 时钟信号
</span><span class=c1></span>    <span class=k>input</span> <span class=n>rst</span><span class=p>,</span>                  <span class=c1>// 复位信号
</span><span class=c1></span>    <span class=k>output</span> <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>read_data_1</span><span class=p>,</span>  <span class=c1>// 输出的第一位操作数
</span><span class=c1></span>    <span class=k>output</span> <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>read_data_2</span><span class=p>,</span>  <span class=c1>// 输出的第二位操作数
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>Sign_extend</span><span class=p>,</span>        <span class=c1>// 译码单元输出的拓展后的32位立即数
</span><span class=c1></span>    <span class=k>input</span> <span class=kt>reg</span> <span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>register</span><span class=p>[</span><span class=mh>0</span><span class=o>:</span><span class=mh>31</span><span class=p>]</span> <span class=c1>// 寄存器文件共32个32位寄存器
</span><span class=c1></span>    <span class=p>);</span>
    <span class=kt>reg</span> <span class=p>[</span><span class=mh>4</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>write_register_address</span><span class=p>;</span>       <span class=c1>// 需要写入的寄存器地址
</span><span class=c1></span>    <span class=kt>reg</span> <span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>write_date</span><span class=p>;</span>                  <span class=c1>// 需要写入寄存器的数据
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>4</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>read_register_1_address</span><span class=p>;</span>      <span class=c1>// 需要读取的第一个寄存器（rs）的地址
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>4</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>read_register_2_address</span><span class=p>;</span>      <span class=c1>// 需要读取的第二个寄存器（rt）的地址
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>4</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>write_register_1_address</span><span class=p>;</span>     <span class=c1>// R-type 指令需要写入的寄存器（rd）的地址
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>4</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>write_register_2_address</span><span class=p>;</span>     <span class=c1>// I-type 指令需要写入的寄存器（rt）的地址
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>Instruction_immediate_value</span><span class=p>;</span> <span class=c1>// 指令中的立即数
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>5</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>opcode</span><span class=p>;</span>                       <span class=c1>// 指令码
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>5</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>funct</span><span class=p>;</span>
    <span class=kt>reg</span> <span class=n>R_type</span><span class=p>,</span> <span class=n>I_type</span><span class=p>,</span> <span class=n>J_type</span><span class=p>,</span> <span class=n>C_type</span><span class=p>;</span>    <span class=c1>// C_type All coprocessor instructions
</span><span class=c1></span>    <span class=kt>reg</span> <span class=n>andi</span><span class=p>,</span> <span class=n>ori</span><span class=p>;</span>

    <span class=cm>/* 指令中各分量的提取 */</span>
    <span class=k>assign</span> <span class=n>opcode</span> <span class=o>=</span> <span class=n>Instruction</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>26</span><span class=p>];</span>                     <span class=c1>// OP
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>funct</span> <span class=o>=</span> <span class=n>Instruction</span><span class=p>[</span><span class=mh>5</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>                        <span class=c1>// funct
</span><span class=c1></span>    <span class=k>always</span><span class=p>@</span><span class=o>*</span> <span class=k>begin</span>
        <span class=p>{</span><span class=n>andi</span><span class=p>,</span> <span class=n>ori</span><span class=p>}</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b00</span><span class=p>;</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>I_type</span><span class=p>)</span>
            <span class=k>case</span><span class=p>(</span><span class=n>opcode</span><span class=p>)</span>
            <span class=mh>6</span><span class=mb>&#39;b001100</span><span class=o>:</span>  <span class=p>{</span><span class=n>andi</span><span class=p>,</span> <span class=n>ori</span><span class=p>}</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b10</span><span class=p>;</span>
            <span class=mh>6</span><span class=mb>&#39;b001101</span><span class=o>:</span>  <span class=p>{</span><span class=n>andi</span><span class=p>,</span> <span class=n>ori</span><span class=p>}</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b01</span><span class=p>;</span>
            <span class=k>endcase</span>
    <span class=k>end</span>
    
    <span class=k>assign</span> <span class=n>read_register_1_address</span> <span class=o>=</span> <span class=n>Instruction</span><span class=p>[</span><span class=mh>25</span><span class=o>:</span><span class=mh>21</span><span class=p>];</span>    <span class=c1>// rs
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>read_register_2_address</span> <span class=o>=</span> <span class=n>Instruction</span><span class=p>[</span><span class=mh>20</span><span class=o>:</span><span class=mh>16</span><span class=p>];</span>    <span class=c1>// rt (R-type)
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>write_register_1_address</span> <span class=o>=</span> <span class=n>Instruction</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>11</span><span class=p>];</span>   <span class=c1>// rd (R-type)
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>write_register_2_address</span> <span class=o>=</span> <span class=n>Instruction</span><span class=p>[</span><span class=mh>20</span><span class=o>:</span><span class=mh>16</span><span class=p>];</span>   <span class=c1>// rt (I-type)
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>Instruction_immediate_value</span> <span class=o>=</span> <span class=n>Instruction</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span> <span class=c1>// data, rladr (I-type)
</span><span class=c1></span>    
    <span class=cm>/* 读取寄存器 */</span>
    <span class=k>assign</span> <span class=n>read_data_1</span> <span class=o>=</span> <span class=n>register</span><span class=p>[</span><span class=n>read_register_1_address</span><span class=p>];</span>
    <span class=k>assign</span> <span class=n>read_data_2</span> <span class=o>=</span> <span class=n>register</span><span class=p>[</span><span class=n>read_register_2_address</span><span class=p>];</span>
    
    <span class=k>always</span> <span class=p>@</span><span class=o>*</span> <span class=k>begin</span> 
        <span class=p>{</span><span class=n>R_type</span><span class=p>,</span> <span class=n>I_type</span><span class=p>,</span> <span class=n>J_type</span><span class=p>,</span> <span class=n>C_type</span><span class=p>}</span> <span class=o>=</span> <span class=mh>4</span><span class=mb>&#39;b0000</span><span class=p>;</span>
            <span class=k>case</span><span class=p>(</span><span class=n>opcode</span><span class=p>)</span>
            <span class=mh>6</span><span class=mb>&#39;b0000</span><span class=nl>_00:</span> <span class=p>{</span><span class=n>R_type</span><span class=p>,</span> <span class=n>I_type</span><span class=p>,</span> <span class=n>J_type</span><span class=p>,</span> <span class=n>C_type</span><span class=p>}</span> <span class=o>=</span> <span class=mh>4</span><span class=mb>&#39;b1000</span><span class=p>;</span>
            <span class=mh>6</span><span class=mb>&#39;b0000</span><span class=nl>_1x:</span> <span class=p>{</span><span class=n>R_type</span><span class=p>,</span> <span class=n>I_type</span><span class=p>,</span> <span class=n>J_type</span><span class=p>,</span> <span class=n>C_type</span><span class=p>}</span> <span class=o>=</span> <span class=mh>4</span><span class=mb>&#39;b0010</span><span class=p>;</span>
            <span class=mh>6</span><span class=mb>&#39;b0100</span><span class=nl>_xx:</span> <span class=p>{</span><span class=n>R_type</span><span class=p>,</span> <span class=n>I_type</span><span class=p>,</span> <span class=n>J_type</span><span class=p>,</span> <span class=n>C_type</span><span class=p>}</span> <span class=o>=</span> <span class=mh>4</span><span class=mb>&#39;b0001</span><span class=p>;</span>
            <span class=k>default</span><span class=o>:</span>    <span class=p>{</span><span class=n>R_type</span><span class=p>,</span> <span class=n>I_type</span><span class=p>,</span> <span class=n>J_type</span><span class=p>,</span> <span class=n>C_type</span><span class=p>}</span> <span class=o>=</span> <span class=mh>4</span><span class=mb>&#39;b0100</span><span class=p>;</span>
            <span class=k>endcase</span>
<span class=c1>//            $display(&#34;time:%3dns, {R_type, I_type, J_type, C_type} = %b&#34;, $time, {R_type, I_type, J_type, C_type});
</span><span class=c1></span>        <span class=cm>/* 目标寄存器的指定 */</span> 
        <span class=k>if</span> <span class=p>(</span><span class=n>R_type</span><span class=p>)</span>     <span class=c1>// R-type =&gt; rd
</span><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=n>write_register_1_address</span> <span class=o>!=</span> <span class=mh>5</span><span class=mb>&#39;b0</span><span class=n>_0000</span><span class=p>)</span> <span class=k>begin</span>  <span class=c1>// 避免写入 0 号寄存器
</span><span class=c1></span>                <span class=n>write_register_address</span> <span class=o>=</span> <span class=n>write_register_1_address</span><span class=p>;</span>
<span class=c1>//                $display(&#34;time:%3dns, R_type, write_register_address = %d, write_register_1_address = %d, Instruction = %b&#34;, $time, write_register_address, write_register_1_address, Instruction);
</span><span class=c1></span>            <span class=k>end</span> <span class=k>else</span>
                <span class=n>register</span><span class=p>[</span><span class=mh>0</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>I_type</span><span class=p>)</span> <span class=k>begin</span><span class=c1>// I-type =&gt; rt
</span><span class=c1></span>            <span class=n>write_register_address</span> <span class=o>=</span> <span class=mh>5</span><span class=mb>&#39;b0</span><span class=n>_0001</span><span class=p>;</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>write_register_2_address</span> <span class=o>!=</span> <span class=mh>5</span><span class=mb>&#39;b0</span><span class=n>_0000</span><span class=p>)</span> <span class=k>begin</span> <span class=c1>// 避免写入 0 号寄存器
</span><span class=c1></span>                <span class=n>write_register_address</span> <span class=o>=</span> <span class=n>write_register_2_address</span><span class=p>;</span>
<span class=c1>//                $display(&#34;time:%3dns, I_type, write_register_address = %d, write_register_2_address = %d, Instruction = %b&#34;, $time, write_register_address, write_register_2_address, Instruction);
</span><span class=c1></span>            <span class=k>end</span> <span class=k>else</span>
                  <span class=n>register</span><span class=p>[</span><span class=mh>0</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
        <span class=k>end</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>Jal</span><span class=p>)</span>   <span class=c1>// Jal
</span><span class=c1></span>            <span class=n>write_register_address</span> <span class=o>=</span> <span class=mh>5</span><span class=mi>&#39;d31</span><span class=p>;</span>
<span class=c1>//        $display (&#34;time = %3d, write_register_address = %d, write_register_1_address = %d, write_register_2_address = %d&#34;, $time, write_register_address, write_register_1_address, write_register_2_address);
</span><span class=c1></span>        <span class=cm>/* 准备要写的数据 */</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>~</span><span class=n>MemtoReg</span><span class=p>)</span> <span class=n>write_date</span> <span class=o>=</span> <span class=n>ALU_result</span><span class=p>;</span>
        <span class=k>else</span> <span class=n>write_date</span> <span class=o>=</span> <span class=n>read_data</span><span class=p>;</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>RegDst</span><span class=p>)</span> <span class=n>write_date</span> <span class=o>=</span> <span class=n>opcplus4</span><span class=p>;</span>
<span class=c1>//        $monitor (&#34;time:%3dns, write_date = %h\n&#34;, $time, write_date);
</span><span class=c1></span>    <span class=k>end</span>
    
    <span class=cm>/* 对寄存器的写入操作 */</span>
    <span class=k>integer</span> <span class=n>i</span><span class=p>;</span>
    <span class=k>always</span> <span class=p>@(</span><span class=k>posedge</span> <span class=n>clk</span><span class=p>)</span> <span class=k>begin</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>rst</span> <span class=o>==</span> <span class=mh>1</span><span class=p>)</span>
            <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mh>32</span><span class=p>;</span> <span class=n>i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mh>1</span><span class=p>)</span>
                <span class=n>register</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>i</span><span class=p>;</span>
        <span class=k>else</span> <span class=k>begin</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>RegWrite</span> <span class=o>==</span> <span class=mh>1</span><span class=p>)</span> <span class=n>register</span><span class=p>[</span><span class=n>write_register_address</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>write_date</span><span class=p>;</span>
        <span class=k>end</span>
    <span class=k>end</span>
    <span class=cm>/* 立即数的扩展 */</span>
    <span class=kt>wire</span> <span class=n>sign</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>sign</span> <span class=o>=</span> <span class=o>~</span><span class=p>(</span><span class=n>andi</span> <span class=o>||</span> <span class=n>ori</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>Instruction_immediate_value</span><span class=p>[</span><span class=mh>15</span><span class=p>];</span> <span class=c1>// andi ori: ZeroExtImm else SignExtImm
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>Sign_extend</span> <span class=o>=</span> <span class=n>sign</span> <span class=o>?</span> <span class=p>{</span><span class=mh>16&#39;hffff</span><span class=p>,</span> <span class=n>Instruction_immediate_value</span><span class=p>}</span><span class=o>:</span><span class=p>{</span><span class=mh>16&#39;h0000</span><span class=p>,</span> <span class=n>Instruction_immediate_value</span><span class=p>};</span>
    
<span class=k>endmodule</span>

</code></pre></td></tr></table></div>
</div>
</div><h3 id=执行单元><a href=#执行单元 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:执行单元 class=headings>执行单元</a></h3>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=k>module</span> <span class=n>execute_unitx32</span><span class=p>(</span>
    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>  <span class=n>Read_data_1</span><span class=p>,</span>       <span class=c1>// 从译码单元的Read_data_1中来  R[rs]
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>  <span class=n>Read_data_2</span><span class=p>,</span>       <span class=c1>// 从译码单元的Read_data_2中来  R[rt]
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>  <span class=n>Sign_extend</span><span class=p>,</span>       <span class=c1>// 从译码单元来的扩展后的立即数
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>5</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>Function_opcode</span><span class=p>,</span>   <span class=c1>// 取指单元来的r-类型指令功能码,r-form instructions[5:0]
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>5</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>Exe_opcode</span><span class=p>,</span>        <span class=c1>// 取指单元来的操作码
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>ALUOp</span><span class=p>,</span>             <span class=c1>// 来自控制单元的运算指令控制编码
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>4</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>Shamt</span><span class=p>,</span>             <span class=c1>// 来自取指单元的instruction[10:6]，指定移位次数
</span><span class=c1></span>    <span class=k>input</span> <span class=kt>wire</span>   <span class=n>Sftmd</span><span class=p>,</span>             <span class=c1>// 来自控制单元的，表明是移位指令
</span><span class=c1></span>    <span class=k>input</span>        <span class=n>ALUSrc</span><span class=p>,</span>            <span class=c1>// 来自控制单元，表明第二个操作数是立即数（beq，bne除外）
</span><span class=c1></span>    <span class=k>input</span>        <span class=n>I_format</span><span class=p>,</span>          <span class=c1>// 来自控制单元，表明是除beq, bne, LW, SW之外的I-类型指令
</span><span class=c1></span>    <span class=k>input</span>        <span class=n>Jrn</span><span class=p>,</span>               <span class=c1>// 来自控制单元，书名是JR指令
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>Zero</span><span class=p>,</span>              <span class=c1>// 为1表明计算值为0 
</span><span class=c1></span>    <span class=k>output</span> <span class=kt>reg</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ALU_Result</span><span class=p>,</span>    <span class=c1>// 计算的数据结果
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>Add_Result</span><span class=p>,</span>        <span class=c1>// 计算的地址结果        
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>  <span class=n>PC_plus_4</span>          <span class=c1>// 来自取指单元的PC+4
</span><span class=c1></span><span class=p>);</span> 
    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>  <span class=n>Ainput</span><span class=p>,</span><span class=n>Binput</span><span class=p>;</span>
    <span class=kt>reg</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>Sinput</span><span class=p>;</span>
    <span class=kt>reg</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>ALU_output_mux</span><span class=p>;</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>32</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>  <span class=n>Branch_Add</span><span class=p>;</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>2</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>ALU_ctl</span><span class=p>;</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>5</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>Exe_code</span><span class=p>;</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>2</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>Sftm</span><span class=p>;</span>
    
    <span class=k>assign</span> <span class=n>Sftm</span> <span class=o>=</span> <span class=n>Function_opcode</span><span class=p>[</span><span class=mh>2</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>   <span class=c1>// 实际有用的只有低三位(移位指令）
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>Exe_code</span> <span class=o>=</span> <span class=p>(</span><span class=n>I_format</span><span class=o>==</span><span class=mh>0</span><span class=p>)</span> <span class=o>?</span> <span class=n>Function_opcode</span> <span class=o>:</span> <span class=p>{</span><span class=mh>3</span><span class=mb>&#39;b000</span><span class=p>,</span><span class=n>Exe_opcode</span><span class=p>[</span><span class=mh>2</span><span class=o>:</span><span class=mh>0</span><span class=p>]};</span>
    <span class=k>assign</span> <span class=n>Ainput</span> <span class=o>=</span> <span class=n>Read_data_1</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>Binput</span> <span class=o>=</span> <span class=p>(</span><span class=n>ALUSrc</span> <span class=o>==</span> <span class=mh>0</span><span class=p>)</span> <span class=o>?</span> <span class=n>Read_data_2</span> <span class=o>:</span> <span class=n>Sign_extend</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span> <span class=c1>//R/LW,SW  sft  else的时候含LW和SW
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>ALU_ctl</span><span class=p>[</span><span class=mh>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>Exe_code</span><span class=p>[</span><span class=mh>0</span><span class=p>]</span> <span class=o>|</span> <span class=n>Exe_code</span><span class=p>[</span><span class=mh>3</span><span class=p>])</span> <span class=o>&amp;</span> <span class=n>ALUOp</span><span class=p>[</span><span class=mh>1</span><span class=p>];</span>      <span class=c1>//24H AND 
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>ALU_ctl</span><span class=p>[</span><span class=mh>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>((</span><span class=o>!</span><span class=n>Exe_code</span><span class=p>[</span><span class=mh>2</span><span class=p>])</span> <span class=o>|</span> <span class=p>(</span><span class=o>!</span><span class=n>ALUOp</span><span class=p>[</span><span class=mh>1</span><span class=p>]));</span>
    <span class=k>assign</span> <span class=n>ALU_ctl</span><span class=p>[</span><span class=mh>2</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>Exe_code</span><span class=p>[</span><span class=mh>1</span><span class=p>]</span> <span class=o>&amp;</span> <span class=n>ALUOp</span><span class=p>[</span><span class=mh>1</span><span class=p>])</span> <span class=o>|</span> <span class=n>ALUOp</span><span class=p>[</span><span class=mh>0</span><span class=p>];</span>

<span class=k>always</span> <span class=p>@</span><span class=o>*</span> <span class=k>begin</span>  <span class=c1>// 6种移位指令
</span><span class=c1></span>       <span class=k>if</span><span class=p>(</span><span class=n>Sftmd</span><span class=p>)</span>
        <span class=k>case</span><span class=p>(</span><span class=n>Sftm</span><span class=p>[</span><span class=mh>2</span><span class=o>:</span><span class=mh>0</span><span class=p>])</span>
            <span class=mh>3</span><span class=mb>&#39;b000</span><span class=o>:</span><span class=n>Sinput</span> <span class=o>=</span> <span class=n>Read_data_2</span> <span class=o>&lt;&lt;</span> <span class=n>Shamt</span><span class=p>;</span>       <span class=c1>//Sll rd,rt,shamt  00000
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b010</span><span class=o>:</span><span class=n>Sinput</span> <span class=o>=</span> <span class=n>Read_data_2</span> <span class=o>&gt;&gt;</span> <span class=n>Shamt</span><span class=p>;</span>       <span class=c1>//Srl rd,rt,shamt  00010
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b100</span><span class=o>:</span><span class=n>Sinput</span> <span class=o>=</span> <span class=n>Read_data_2</span> <span class=o>&lt;&lt;</span> <span class=n>Read_data_1</span><span class=p>;</span> <span class=c1>//Sllu rd,rt,rs 000100
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b110</span><span class=o>:</span><span class=n>Sinput</span> <span class=o>=</span> <span class=n>Read_data_2</span> <span class=o>&gt;&gt;</span> <span class=n>Read_data_1</span><span class=p>;</span> <span class=c1>//Srlu rd,rt,rs 000110
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b011</span><span class=o>:</span><span class=n>Sinput</span> <span class=o>=</span> <span class=p>(</span><span class=n>$signed</span><span class=p>(</span><span class=n>Read_data_2</span><span class=p>))</span> <span class=o>&gt;&gt;&gt;</span> <span class=n>Shamt</span><span class=p>;</span>       <span class=c1>//Sra rd,rt,shamt 00011
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b111</span><span class=o>:</span><span class=n>Sinput</span> <span class=o>=</span> <span class=p>(</span><span class=n>$signed</span><span class=p>(</span><span class=n>Read_data_2</span><span class=p>))</span> <span class=o>&gt;&gt;&gt;</span> <span class=n>Read_data_1</span><span class=p>;</span> <span class=c1>//Srav rd,rt,rs 00111
</span><span class=c1></span>            <span class=k>default</span><span class=o>:</span><span class=n>Sinput</span> <span class=o>=</span> <span class=n>Binput</span><span class=p>;</span>
        <span class=k>endcase</span>
       <span class=k>else</span> <span class=n>Sinput</span> <span class=o>=</span> <span class=n>Binput</span><span class=p>;</span>
    <span class=k>end</span>
 
    <span class=k>always</span> <span class=p>@</span><span class=o>*</span> <span class=k>begin</span>
        <span class=k>if</span><span class=p>(((</span><span class=n>ALU_ctl</span><span class=o>==</span><span class=mh>3</span><span class=mb>&#39;b111</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>Exe_code</span><span class=p>[</span><span class=mh>3</span><span class=p>]</span><span class=o>==</span><span class=mh>1</span><span class=p>))</span><span class=o>||</span><span class=p>((</span><span class=n>ALU_ctl</span><span class=p>[</span><span class=mh>2</span><span class=o>:</span><span class=mh>1</span><span class=p>]</span><span class=o>==</span><span class=mh>2</span><span class=mb>&#39;b11</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>I_format</span><span class=o>==</span><span class=mh>1</span><span class=p>)))</span> <span class=c1>//slti(sub)  处理所有SLT类的问题
</span><span class=c1></span>            <span class=n>ALU_Result</span> <span class=o>=</span> <span class=n>Read_data_1</span> <span class=o>&lt;</span> <span class=n>Read_data_2</span> <span class=o>?</span> <span class=mh>1</span><span class=mb>&#39;b1</span> <span class=o>:</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
        <span class=k>else</span> <span class=k>if</span><span class=p>((</span><span class=n>ALU_ctl</span><span class=o>==</span><span class=mh>3</span><span class=mb>&#39;b101</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>I_format</span><span class=o>==</span><span class=mh>1</span><span class=p>))</span> <span class=c1>// lui: load upper immediate
</span><span class=c1></span>            <span class=n>ALU_Result</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=n>Binput</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>],</span> <span class=p>{</span><span class=mh>16</span><span class=p>{</span><span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>}}};</span>   
        <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>Sftmd</span><span class=o>==</span><span class=mh>1</span><span class=p>)</span>   <span class=c1>// 移位
</span><span class=c1></span>            <span class=n>ALU_Result</span> <span class=o>=</span> <span class=n>Sinput</span><span class=p>;</span>   
        <span class=k>else</span>  <span class=n>ALU_Result</span> <span class=o>=</span> <span class=n>ALU_output_mux</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>    <span class=c1>// otherwise
</span><span class=c1></span>    <span class=k>end</span>
 
    <span class=k>assign</span> <span class=n>Branch_Add</span> <span class=o>=</span> <span class=n>PC_plus_4</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>2</span><span class=p>]</span> <span class=o>+</span> <span class=n>Sign_extend</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>
    <span class=k>assign</span> <span class=n>Add_Result</span> <span class=o>=</span> <span class=n>Branch_Add</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>   <span class=c1>//算出的下一个PC值已经做了除4处理，所以不需左移16位
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>Zero</span> <span class=o>=</span> <span class=p>(</span><span class=n>ALU_output_mux</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span><span class=o>==</span> <span class=mh>32&#39;h00000000</span><span class=p>)</span> <span class=o>?</span> <span class=mh>1</span><span class=mb>&#39;b1</span> <span class=o>:</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    
    <span class=k>always</span> <span class=p>@(</span><span class=n>ALU_ctl</span> <span class=k>or</span> <span class=n>Ainput</span> <span class=k>or</span> <span class=n>Binput</span><span class=p>)</span> <span class=k>begin</span>
        <span class=k>case</span><span class=p>(</span><span class=n>ALU_ctl</span><span class=p>)</span>
            <span class=mh>3</span><span class=mb>&#39;b000</span><span class=o>:</span><span class=n>ALU_output_mux</span> <span class=o>=</span> <span class=n>Ainput</span> <span class=o>&amp;</span> <span class=n>Binput</span><span class=p>;</span>    <span class=c1>// and, andi
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b001</span><span class=o>:</span><span class=n>ALU_output_mux</span> <span class=o>=</span> <span class=n>Ainput</span> <span class=o>|</span> <span class=n>Binput</span><span class=p>;</span>    <span class=c1>// or, ori
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b010</span><span class=o>:</span><span class=n>ALU_output_mux</span> <span class=o>=</span> <span class=n>Ainput</span> <span class=o>+</span> <span class=n>Binput</span><span class=p>;</span>    <span class=c1>// add, addi, lw, sw // 计算地址
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b011</span><span class=o>:</span><span class=n>ALU_output_mux</span> <span class=o>=</span> <span class=n>Ainput</span> <span class=o>+</span> <span class=n>Binput</span><span class=p>;</span>    <span class=c1>// addu, addiu
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b100</span><span class=o>:</span><span class=n>ALU_output_mux</span> <span class=o>=</span> <span class=n>Ainput</span> <span class=o>^</span> <span class=n>Binput</span><span class=p>;</span>    <span class=c1>// xor, xori
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b101</span><span class=o>:</span><span class=n>ALU_output_mux</span> <span class=o>=</span> <span class=o>~</span><span class=p>(</span><span class=n>Ainput</span> <span class=o>|</span> <span class=n>Binput</span><span class=p>);</span> <span class=c1>// nor, lui
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b110</span><span class=o>:</span><span class=n>ALU_output_mux</span> <span class=o>=</span> <span class=n>Ainput</span> <span class=o>-</span> <span class=n>Binput</span><span class=p>;</span>    <span class=c1>// sub, slti, beq, bne
</span><span class=c1></span>            <span class=mh>3</span><span class=mb>&#39;b111</span><span class=o>:</span><span class=n>ALU_output_mux</span> <span class=o>=</span> <span class=n>Ainput</span> <span class=o>-</span> <span class=n>Binput</span><span class=p>;</span>    <span class=c1>// subu, sltiu, slt, sltu
</span><span class=c1></span>            <span class=k>default</span><span class=o>:</span><span class=n>ALU_output_mux</span> <span class=o>=</span> <span class=mh>32&#39;h00000000</span><span class=p>;</span>
        <span class=k>endcase</span>
    <span class=k>end</span>
<span class=k>endmodule</span>

</code></pre></td></tr></table></div>
</div>
</div><h3 id=取指单元><a href=#取指单元 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:取指单元 class=headings>取指单元</a></h3>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=no>`timescale</span> <span class=mh>1</span><span class=n>ns</span> <span class=o>/</span> <span class=mh>1</span><span class=n>ps</span>
<span class=c1>//////////////////////////////////////////////////////////////////////////////////
</span><span class=c1></span><span class=k>module</span> <span class=n>Ifetc32</span><span class=p>(</span><span class=n>Instruction</span><span class=p>,</span><span class=n>PC_plus_4_out</span><span class=p>,</span><span class=n>Add_result</span><span class=p>,</span><span class=n>Read_data_1</span><span class=p>,</span><span class=n>Branch</span><span class=p>,</span><span class=n>nBranch</span><span class=p>,</span><span class=n>Jmp</span><span class=p>,</span><span class=n>Jal</span><span class=p>,</span><span class=n>Jrn</span><span class=p>,</span><span class=n>Zero</span><span class=p>,</span><span class=n>clock</span><span class=p>,</span><span class=n>reset</span><span class=p>,</span><span class=n>opcplus4</span><span class=p>,</span> <span class=n>next_PC</span><span class=p>,</span> <span class=n>PC</span><span class=p>);</span>
    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>Instruction</span><span class=p>;</span>			<span class=c1>// ���ָ�����ģ��
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>PC_plus_4_out</span><span class=p>;</span>         <span class=c1>// (pc+4)��ִ�е�Ԫ
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>  <span class=n>Add_result</span><span class=p>;</span>            <span class=c1>// ����ִ�е�Ԫ,�������ת��ַ, beq �� bne
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>  <span class=n>Read_data_1</span><span class=p>;</span>           <span class=c1>// �������뵥Ԫ��jrָ���õĵ�ַ
</span><span class=c1></span>    <span class=k>input</span>        <span class=n>Branch</span><span class=p>;</span>                <span class=c1>// ���Կ��Ƶ�Ԫ
</span><span class=c1></span>    <span class=k>input</span>        <span class=n>nBranch</span><span class=p>;</span>               <span class=c1>// ���Կ��Ƶ�Ԫ
</span><span class=c1></span>    <span class=k>input</span>        <span class=n>Jmp</span><span class=p>;</span>                   <span class=c1>// ���Կ��Ƶ�Ԫ
</span><span class=c1></span>    <span class=k>input</span>        <span class=n>Jal</span><span class=p>;</span>                   <span class=c1>// ���Կ��Ƶ�Ԫ
</span><span class=c1></span>    <span class=k>input</span>        <span class=n>Jrn</span><span class=p>;</span>                   <span class=c1>// ���Կ��Ƶ�Ԫ
</span><span class=c1></span>    <span class=k>input</span>        <span class=n>Zero</span><span class=p>;</span>                  <span class=c1>// ����ִ�е�Ԫ, beq �� bne
</span><span class=c1></span>    <span class=k>input</span>        <span class=n>clock</span><span class=p>,</span> <span class=n>reset</span><span class=p>;</span>          <span class=c1>// ʱ���븴λ
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>opcplus4</span><span class=p>;</span>              <span class=c1>// JALָ��ר�õ�PC+4
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>next_PC</span><span class=p>;</span>
    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>PC</span><span class=p>;</span>
    
    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>PC_plus_4</span><span class=p>;</span>             <span class=c1>// PC+4
</span><span class=c1></span>    <span class=kt>reg</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>	  <span class=n>PC</span><span class=p>;</span>                    <span class=c1>// PC�Ĵ����������������
</span><span class=c1></span>    <span class=kt>reg</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>    <span class=n>next_PC</span><span class=p>;</span>               <span class=c1>// ����ָ���PC����һ����PC+4)
</span><span class=c1></span>    <span class=kt>reg</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>    <span class=n>opcplus4</span><span class=p>;</span>
    
   <span class=c1>//����64KB ROM��������ʵ��ֻ�� 64KB ROM
</span><span class=c1></span>    <span class=n>prgrom</span> <span class=n>instmem</span><span class=p>(</span>
        <span class=p>.</span><span class=n>clka</span><span class=p>(</span><span class=n>clock</span><span class=p>),</span>                   <span class=c1>// input wire clka
</span><span class=c1></span>        <span class=p>.</span><span class=n>addra</span><span class=p>(</span><span class=n>PC</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>2</span><span class=p>]),</span>               <span class=c1>// input wire [13:0] addra
</span><span class=c1></span>        <span class=p>.</span><span class=n>douta</span><span class=p>(</span><span class=n>Instruction</span><span class=p>)</span>             <span class=c1>// output wire [31:0] douta
</span><span class=c1></span>    <span class=p>);</span>
    
    <span class=k>assign</span> <span class=n>PC_plus_4</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>PC</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>2</span><span class=p>]</span><span class=o>+</span><span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>PC_plus_4</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b00</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>PC_plus_4_out</span> <span class=o>=</span> <span class=n>PC_plus_4</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>
    <span class=c1>// beq $n ,$m if $n=$m branch   bne if $n /=$m branch jr
</span><span class=c1></span>    <span class=k>always</span> <span class=p>@</span><span class=o>*</span> <span class=k>begin</span>  
        <span class=k>if</span> <span class=p>((</span><span class=n>Branch</span> <span class=o>&amp;</span> <span class=n>Zero</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=n>nBranch</span> <span class=o>&amp;</span> <span class=o>~</span><span class=n>Zero</span><span class=p>))</span> <span class=n>next_PC</span> <span class=o>=</span> <span class=n>Add_result</span><span class=p>;</span>
        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>Jrn</span><span class=p>)</span> <span class=n>next_PC</span> <span class=o>=</span> <span class=n>Read_data_1</span><span class=p>;</span>
        <span class=k>else</span> <span class=n>next_PC</span> <span class=o>=</span> <span class=n>PC_plus_4</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>2</span><span class=p>];</span>
    <span class=k>end</span>
    <span class=c1>//����J��Jalָ���reset�Ĵ��� 
</span><span class=c1></span>    <span class=k>always</span><span class=p>@(</span><span class=k>negedge</span> <span class=n>clock</span><span class=p>)</span> <span class=k>begin</span>  
        <span class=k>if</span> <span class=p>(</span><span class=n>reset</span><span class=p>)</span> <span class=k>begin</span>
            <span class=n>PC</span> <span class=o>=</span> <span class=mh>32</span><span class=mb>&#39;b0</span><span class=p>;</span>
            <span class=n>next_PC</span> <span class=o>=</span> <span class=mh>32</span><span class=mb>&#39;b1</span><span class=p>;</span>
        <span class=k>end</span> <span class=k>else</span> <span class=k>begin</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>Jmp</span><span class=p>)</span> <span class=n>PC</span> <span class=o>=</span> <span class=n>opcplus4</span><span class=p>;</span>
            <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>Jal</span><span class=p>)</span> <span class=k>begin</span>
                <span class=n>PC</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>28</span><span class=p>]</span> <span class=o>=</span> <span class=n>PC_plus_4_out</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>28</span><span class=p>];</span>
                <span class=n>PC</span><span class=p>[</span><span class=mh>27</span><span class=o>:</span><span class=mh>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>Instruction</span><span class=p>[</span><span class=mh>25</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>
                <span class=n>PC</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b0</span><span class=p>;</span>
                <span class=n>opcplus4</span> <span class=o>=</span> <span class=n>next_PC</span><span class=p>;</span>
            <span class=k>end</span>
            <span class=k>else</span> 
                <span class=n>PC</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>next_PC</span><span class=p>;</span>
        <span class=k>end</span>
    <span class=k>end</span>
<span class=k>endmodule</span>


</code></pre></td></tr></table></div>
</div>
</div><h3 id=控制单元><a href=#控制单元 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:控制单元 class=headings>控制单元</a></h3>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=no>`timescale</span> <span class=mh>1</span><span class=n>ns</span> <span class=o>/</span> <span class=mh>1</span><span class=n>ps</span>
<span class=c1>//////////////////////////////////////////////////////////////////////////////////
</span><span class=c1></span><span class=k>module</span> <span class=n>control32</span><span class=p>(</span><span class=n>Opcode</span><span class=p>,</span> <span class=n>Function_opcode</span><span class=p>,</span> <span class=n>Jrn</span><span class=p>,</span> <span class=n>RegDST</span><span class=p>,</span> <span class=n>ALUSrc</span><span class=p>,</span> <span class=n>MemortoReg</span><span class=p>,</span> <span class=n>RegWrite</span><span class=p>,</span> <span class=n>MemWrite</span><span class=p>,</span> <span class=n>Branch</span><span class=p>,</span> <span class=n>nBranch</span><span class=p>,</span> <span class=n>Jmp</span><span class=p>,</span> <span class=n>Jal</span><span class=p>,</span> <span class=n>I_format</span><span class=p>,</span> <span class=n>Sftmd</span><span class=p>,</span> <span class=n>ALUOp</span><span class=p>);</span>
    <span class=k>input</span><span class=p>[</span><span class=mh>5</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>Opcode</span><span class=p>;</span>            <span class=c1>// 来自取指单元instruction[31..26]
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>5</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>   <span class=n>Function_opcode</span><span class=p>;</span>   <span class=c1>// 来自取指单元r-类型 instructions[5..0]
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>Jrn</span><span class=p>;</span>               <span class=c1>// 为1表明当前指令是jr
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>RegDST</span><span class=p>;</span>            <span class=c1>// 为1表明目的寄存器是rd，否则目的寄存器是rt
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>ALUSrc</span><span class=p>;</span>            <span class=c1>// 为1表明第二个操作数是立即数（beq，bne除外）
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>MemortoReg</span><span class=p>;</span>        <span class=c1>// 为1表明需要从存储器读数据到寄存器
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>RegWrite</span><span class=p>;</span>          <span class=c1>// 为1表明该指令需要写寄存器
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>MemWrite</span><span class=p>;</span>          <span class=c1>// 为1表明该指令需要写存储器
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>Branch</span><span class=p>;</span>            <span class=c1>// 为1表明是Beq指令
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>nBranch</span><span class=p>;</span>           <span class=c1>// 为1表明是Bne指令
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>Jmp</span><span class=p>;</span>               <span class=c1>// 为1表明是J指令
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>Jal</span><span class=p>;</span>               <span class=c1>// 为1表明是Jal指令
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>I_format</span><span class=p>;</span>          <span class=c1>// 为1表明该指令是除beq，bne，LW，SW之外的其他I-类型指令
</span><span class=c1></span>    <span class=k>output</span>       <span class=n>Sftmd</span><span class=p>;</span>             <span class=c1>// 为1表明是移位指令
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span>  <span class=n>ALUOp</span><span class=p>;</span>
   
    <span class=kt>wire</span> <span class=n>Jmp</span><span class=p>,</span><span class=n>I_format</span><span class=p>,</span><span class=n>Jal</span><span class=p>,</span><span class=n>Branch</span><span class=p>,</span><span class=n>nBranch</span><span class=p>;</span>
    <span class=kt>wire</span> <span class=n>R_format</span><span class=p>;</span>        <span class=c1>// 为1表示是R-类型指令
</span><span class=c1></span>    <span class=kt>wire</span> <span class=n>Lw</span><span class=p>;</span>              <span class=c1>// 为1表示是lw指令
</span><span class=c1></span>    <span class=kt>wire</span> <span class=n>Sw</span><span class=p>;</span>              <span class=c1>// 为1表示是sw指令
</span><span class=c1></span>    
    <span class=k>assign</span> <span class=n>R_format</span> <span class=o>=</span> <span class=p>(</span><span class=n>Opcode</span><span class=o>==</span><span class=mh>6</span><span class=mb>&#39;b0000</span><span class=n>_00</span><span class=p>)</span> <span class=o>?</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=o>:</span><span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>    	<span class=c1>// --00h 
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>RegDST</span> <span class=o>=</span> <span class=n>R_format</span><span class=p>;</span>                               <span class=c1>// 说明目标是rd，否则是rt
</span><span class=c1></span>    <span class=k>assign</span> <span class=n>I_format</span> <span class=o>=</span> <span class=p>(</span><span class=n>Opcode</span><span class=p>[</span><span class=mh>5</span><span class=o>:</span><span class=mh>3</span><span class=p>]</span> <span class=o>==</span> <span class=mh>3</span><span class=mb>&#39;b001</span><span class=p>)</span> <span class=o>?</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=o>:</span><span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>Lw</span> <span class=o>=</span> <span class=p>(</span><span class=n>Opcode</span> <span class=o>==</span> <span class=mh>6</span><span class=mb>&#39;b1000</span><span class=n>_11</span><span class=p>);</span>
    <span class=k>assign</span> <span class=n>Jal</span> <span class=o>=</span> <span class=p>(</span><span class=n>Opcode</span> <span class=o>==</span> <span class=mh>6</span><span class=mb>&#39;b0000</span><span class=n>_11</span><span class=p>);</span> 
    <span class=k>assign</span> <span class=n>Jrn</span> <span class=o>=</span> <span class=p>(</span><span class=n>Opcode</span><span class=o>==</span><span class=mh>6</span><span class=mb>&#39;b0000</span><span class=n>_00</span> <span class=o>&amp;</span> <span class=n>Function_opcode</span> <span class=o>==</span> <span class=mh>5&#39;h08</span><span class=p>);</span>   
    <span class=k>assign</span> <span class=n>RegWrite</span> <span class=o>=</span> <span class=p>(</span><span class=n>R_format</span> <span class=o>&amp;</span> <span class=o>~</span><span class=n>Jrn</span> <span class=o>|</span> <span class=n>I_format</span> <span class=o>|</span> <span class=n>Opcode</span> <span class=o>==</span> <span class=mh>6</span><span class=mb>&#39;b1000</span><span class=n>_11</span> <span class=o>|</span> <span class=n>Opcode</span> <span class=o>==</span> <span class=mh>6</span><span class=mb>&#39;b0000</span><span class=n>_11</span><span class=p>);</span>

    <span class=k>assign</span> <span class=n>Sw</span> <span class=o>=</span> <span class=p>(</span><span class=n>Opcode</span><span class=o>==</span><span class=mh>6</span><span class=mb>&#39;b1010</span><span class=n>_11</span><span class=p>);</span>
    <span class=k>assign</span> <span class=n>ALUSrc</span> <span class=o>=</span> <span class=p>(</span><span class=n>I_format</span> <span class=o>|</span> <span class=n>Lw</span> <span class=o>|</span> <span class=n>Sw</span><span class=p>)</span> <span class=o>?</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=o>:</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>Branch</span> <span class=o>=</span> <span class=p>(</span><span class=n>Opcode</span> <span class=o>==</span> <span class=mh>6&#39;h4</span><span class=p>)</span> <span class=o>?</span> <span class=mh>1</span><span class=mb>&#39;b1</span> <span class=o>:</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>nBranch</span> <span class=o>=</span> <span class=p>(</span><span class=n>Opcode</span> <span class=o>==</span> <span class=mh>6&#39;h5</span><span class=p>)</span> <span class=o>?</span> <span class=mh>1</span><span class=mb>&#39;b1</span> <span class=o>:</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>Jmp</span> <span class=o>=</span> <span class=p>(</span><span class=n>Opcode</span> <span class=o>==</span> <span class=mh>6&#39;h2</span><span class=p>)</span> <span class=o>?</span> <span class=mh>1</span><span class=mb>&#39;b1</span> <span class=o>:</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    
    <span class=k>assign</span> <span class=n>MemWrite</span> <span class=o>=</span> <span class=n>Sw</span> <span class=o>?</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=o>:</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>MemortoReg</span> <span class=o>=</span> <span class=n>Lw</span> <span class=o>?</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=o>:</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>Sftmd</span> <span class=o>=</span> <span class=p>(</span><span class=n>R_format</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>Function_opcode</span> <span class=o>==</span> <span class=mh>5&#39;h0</span> <span class=o>|</span> <span class=n>Function_opcode</span> <span class=o>==</span> <span class=mh>5&#39;h2</span><span class=p>))</span> <span class=o>?</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=o>:</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
  
    <span class=k>assign</span> <span class=n>ALUOp</span> <span class=o>=</span> <span class=p>{(</span><span class=n>R_format</span> <span class=o>||</span> <span class=n>I_format</span><span class=p>),(</span><span class=n>Branch</span> <span class=o>||</span> <span class=n>nBranch</span><span class=p>)};</span>  <span class=c1>// 是R－type或需要立即数作32位扩展的指令1位为1,beq、bne指令则0位为1
</span><span class=c1></span><span class=k>endmodule</span>


</code></pre></td></tr></table></div>
</div>
</div><h3 id=memoryio><a href=#memoryio class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:memoryio class=headings>MemoryIO</a></h3>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=k>module</span> <span class=n>memorio</span><span class=p>(</span><span class=n>caddress</span><span class=p>,</span><span class=n>address</span><span class=p>,</span><span class=n>memread</span><span class=p>,</span><span class=n>memwrite</span><span class=p>,</span><span class=n>ioread</span><span class=p>,</span><span class=n>iowrite</span><span class=p>,</span><span class=n>mread_data</span><span class=p>,</span><span class=n>ioread_data</span><span class=p>,</span><span class=n>wdata</span><span class=p>,</span><span class=n>rdata</span><span class=p>,</span><span class=n>write_data</span><span class=p>,</span><span class=n>LEDCtrl</span><span class=p>,</span><span class=n>SwitchCtrl</span><span class=p>);</span>
    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>caddress</span><span class=p>;</span>       <span class=c1>// from alu_result in executs32
</span><span class=c1></span>    <span class=k>input</span> <span class=n>memread</span><span class=p>;</span>				<span class=c1>// read memory, from control32
</span><span class=c1></span>    <span class=k>input</span> <span class=n>memwrite</span><span class=p>;</span>				<span class=c1>// write memory, from control32
</span><span class=c1></span>    <span class=k>input</span> <span class=n>ioread</span><span class=p>;</span>				<span class=c1>// read IO, from control32
</span><span class=c1></span>    <span class=k>input</span> <span class=n>iowrite</span><span class=p>;</span>				<span class=c1>// write IO, from control32
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>mread_data</span><span class=p>;</span>		<span class=c1>// data from memory
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ioread_data</span><span class=p>;</span>	<span class=c1>// data from io,16 bits
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>wdata</span><span class=p>;</span>			<span class=c1>// the data from idecode32,that want to write memory or io
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>rdata</span><span class=p>;</span>			<span class=c1>// data from memory or IO that want to read into register
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>write_data</span><span class=p>;</span>    <span class=c1>// data to memory or I/O
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>address</span><span class=p>;</span>       <span class=c1>// address to mAddress and I/O
</span><span class=c1></span>    <span class=k>output</span> <span class=n>LEDCtrl</span><span class=p>;</span>				<span class=c1>// LED CS
</span><span class=c1></span>    <span class=k>output</span> <span class=n>SwitchCtrl</span><span class=p>;</span>          <span class=c1>// Switch CS
</span><span class=c1></span>    <span class=kt>reg</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>write_data</span><span class=p>;</span>
    <span class=kt>wire</span> <span class=n>iorw</span><span class=p>;</span>
    <span class=k>assign</span>  <span class=n>address</span> <span class=o>=</span> <span class=n>caddress</span><span class=p>;</span>
    <span class=k>assign</span>  <span class=n>rdata</span> <span class=o>=</span> <span class=p>(</span><span class=n>iowrite</span> <span class=o>==</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>)</span> <span class=o>?</span> <span class=p>{</span><span class=mh>16</span><span class=mb>&#39;b0</span><span class=p>,</span> <span class=n>ioread_data</span><span class=p>}</span> <span class=o>:</span> <span class=n>memread</span><span class=p>;</span>  <span class=c1>// 可能是从memory读出，也可能自io读出，自io读取的数据是rdata的低16bit
</span><span class=c1></span>    <span class=k>assign</span>  <span class=n>iorw</span> <span class=o>=</span> <span class=p>(</span><span class=n>iowrite</span><span class=o>||</span><span class=n>ioread</span><span class=p>);</span>
	<span class=c1>//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</span><span class=c1></span>	<span class=k>assign</span>	<span class=n>LEDCtrl</span> <span class=o>=</span> <span class=n>ioread</span><span class=p>;</span>    <span class=c1>// led 模块的片选信号，高电平有效;
</span><span class=c1></span>	<span class=k>assign</span>	<span class=n>SwitchCtrl</span> <span class=o>=</span> <span class=n>memread</span><span class=p>;</span>    <span class=c1>//switch 模块的片选信号，高电平有效					
</span><span class=c1></span>    <span class=k>always</span> <span class=p>@</span><span class=o>*</span> <span class=k>begin</span>
        <span class=k>if</span><span class=p>((</span><span class=n>memwrite</span><span class=o>==</span><span class=mh>1</span><span class=p>)</span><span class=o>||</span><span class=p>(</span><span class=n>iowrite</span><span class=o>==</span><span class=mh>1</span><span class=p>))</span> <span class=k>begin</span>
            <span class=n>write_data</span> <span class=o>=</span> <span class=n>wdata</span><span class=p>;</span>
        <span class=k>end</span> <span class=k>else</span> <span class=k>begin</span>
            <span class=n>write_data</span> <span class=o>=</span> <span class=mh>32</span><span class=p>&#39;</span><span class=n>hZZZZZZZZ</span><span class=p>;</span>
        <span class=k>end</span>
    <span class=k>end</span>
<span class=k>endmodule</span>

<span class=no>`timescale</span> <span class=mh>1</span><span class=n>ns</span> <span class=o>/</span> <span class=mh>1</span><span class=n>ps</span>
<span class=k>module</span> <span class=n>dmemory32</span><span class=p>(</span><span class=n>read_data</span><span class=p>,</span><span class=n>address</span><span class=p>,</span><span class=n>write_data</span><span class=p>,</span><span class=n>Memwrite</span><span class=p>,</span><span class=n>clock</span><span class=p>);</span>
    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>read_data</span><span class=p>;</span>  <span class=c1>// 从存储器中获得的数据
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>address</span><span class=p>;</span>     <span class=c1>//来自memorio模块，源头是来自执行单元算出的alu_result
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>write_data</span><span class=p>;</span>  <span class=c1>//来自译码单元的read_data2
</span><span class=c1></span>    <span class=k>input</span>  <span class=n>Memwrite</span><span class=p>;</span>         <span class=c1>//来自控制单元
</span><span class=c1></span>    <span class=k>input</span>  <span class=n>clock</span><span class=p>;</span>
    
    <span class=kt>wire</span> <span class=n>clk</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>clk</span> <span class=o>=</span> <span class=o>!</span><span class=n>clock</span><span class=p>;</span>     <span class=c1>//  因为使用Block ram的固有延迟，RAM的地址线来不及在时钟上升沿准备好,
</span><span class=c1></span>                             <span class=c1>//  使得时钟上升沿数据读出有误，所以采用反相时钟，使得读出数据比地址准
</span><span class=c1></span>                             <span class=c1>//  备好要晚大约半个时钟，从而得到正确地址。
</span><span class=c1></span>    
    <span class=c1>//分配64KB RAM，编译器实际只用 64KB RAM
</span><span class=c1></span>    <span class=n>RAM</span> <span class=n>ram</span> <span class=p>(</span>
        <span class=p>.</span><span class=n>clka</span><span class=p>(</span><span class=n>clk</span><span class=p>),</span>             <span class=c1>// input wire clka
</span><span class=c1></span>        <span class=p>.</span><span class=n>wea</span><span class=p>(</span><span class=n>Memwrite</span><span class=p>),</span>             <span class=c1>// input wire [0 : 0] wea
</span><span class=c1></span>        <span class=p>.</span><span class=n>addra</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>2</span><span class=p>]),</span>  <span class=c1>// input wire [13 : 0] addra
</span><span class=c1></span>        <span class=p>.</span><span class=n>dina</span><span class=p>(</span><span class=n>write_data</span><span class=p>),</span>      <span class=c1>// input wire [31 : 0] dina
</span><span class=c1></span>        <span class=p>.</span><span class=n>douta</span><span class=p>(</span><span class=n>read_data</span><span class=p>)</span>       <span class=c1>// output wire [31 : 0] douta
</span><span class=c1></span>    <span class=p>);</span>
<span class=k>endmodule</span>

<span class=k>module</span> <span class=n>ioread</span><span class=p>(</span><span class=n>reset</span><span class=p>,</span><span class=n>ior</span><span class=p>,</span><span class=n>switchctrl</span><span class=p>,</span><span class=n>ioread_data</span><span class=p>,</span><span class=n>ioread_data_switch</span><span class=p>);</span>
    <span class=k>input</span> <span class=n>reset</span><span class=p>;</span>			<span class=c1>// 复位信号 
</span><span class=c1></span>    <span class=k>input</span> <span class=n>ior</span><span class=p>;</span>              <span class=c1>//  从控制器来的I/O读，
</span><span class=c1></span>    <span class=k>input</span> <span class=n>switchctrl</span><span class=p>;</span>		<span class=c1>//  从memorio经过地址高端线获得的拨码开关模块片选
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ioread_data_switch</span><span class=p>;</span>  <span class=c1>//从外设来的读数据，此处来自拨码开关
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ioread_data</span><span class=p>;</span>	<span class=c1>// 将外设来的数据送给memorio
</span><span class=c1></span>    
    <span class=kt>reg</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ioread_data</span><span class=p>;</span>
    
    <span class=k>always</span> <span class=p>@</span><span class=o>*</span> <span class=k>begin</span>
        <span class=k>if</span><span class=p>(</span><span class=n>reset</span> <span class=o>==</span> <span class=mh>1</span><span class=p>)</span>
            <span class=n>ioread_data</span> <span class=o>=</span> <span class=mh>16</span><span class=mb>&#39;b0000000000000000</span><span class=p>;</span>
        <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>ior</span> <span class=o>==</span> <span class=mh>1</span><span class=p>)</span> <span class=k>begin</span>
            <span class=k>if</span><span class=p>(</span><span class=n>switchctrl</span> <span class=o>==</span> <span class=mh>1</span><span class=p>)</span>
                <span class=n>ioread_data</span> <span class=o>=</span> <span class=n>ioread_data_switch</span><span class=p>;</span>
            <span class=k>else</span>   <span class=n>ioread_data</span> <span class=o>=</span> <span class=n>ioread_data</span><span class=p>;</span>
        <span class=k>end</span>
    <span class=k>end</span>
<span class=k>endmodule</span>

<span class=k>module</span> <span class=n>leds</span><span class=p>(</span><span class=n>led_clk</span><span class=p>,</span> <span class=n>ledrst</span><span class=p>,</span> <span class=n>ledwrite</span><span class=p>,</span> <span class=n>ledcs</span><span class=p>,</span> <span class=n>ledaddr</span><span class=p>,</span><span class=n>ledwdata</span><span class=p>,</span> <span class=n>ledout</span><span class=p>);</span>
    <span class=k>input</span> <span class=n>led_clk</span><span class=p>;</span>    		    <span class=c1>// 时钟信号
</span><span class=c1></span>    <span class=k>input</span> <span class=n>ledrst</span><span class=p>;</span> 		        <span class=c1>// 复位信号
</span><span class=c1></span>    <span class=k>input</span> <span class=n>ledwrite</span><span class=p>;</span>		       <span class=c1>// 写信号
</span><span class=c1></span>    <span class=k>input</span> <span class=n>ledcs</span><span class=p>;</span>		      <span class=c1>// 从memorio来的，由低至高位形成的LED片选信号   !!!!!!!!!!!!!!!!!
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ledaddr</span><span class=p>;</span>	        <span class=c1>//  到LED模块的地址低端  !!!!!!!!!!!!!!!!!!!!
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ledwdata</span><span class=p>;</span>	  <span class=c1>//  写到LED模块的数据，注意数据线只有16根
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>23</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ledout</span><span class=p>;</span>	<span class=c1>//  向板子上输出的24位LED信号
</span><span class=c1></span>  
    <span class=kt>reg</span> <span class=p>[</span><span class=mh>23</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ledout</span><span class=p>;</span>
    
    <span class=k>always</span><span class=p>@(</span><span class=k>posedge</span> <span class=n>led_clk</span> <span class=k>or</span> <span class=k>posedge</span> <span class=n>ledrst</span><span class=p>)</span> <span class=k>begin</span>
        <span class=k>if</span><span class=p>(</span><span class=n>ledrst</span><span class=p>)</span> <span class=k>begin</span>
            <span class=n>ledout</span> <span class=o>&lt;=</span> <span class=mh>24&#39;h000000</span><span class=p>;</span>
        <span class=k>end</span>
		<span class=c1>//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</span><span class=c1></span>		<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>ledcs</span> <span class=o>&amp;&amp;</span> <span class=n>ledwrite</span><span class=p>)</span> <span class=k>begin</span>
			<span class=k>if</span><span class=p>(</span><span class=n>ledaddr</span> <span class=o>==</span> <span class=mh>2</span><span class=mb>&#39;b00</span><span class=p>)</span>
				<span class=n>ledout</span><span class=p>[</span><span class=mh>23</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=p>{</span> <span class=n>ledout</span><span class=p>[</span><span class=mh>23</span><span class=o>:</span><span class=mh>16</span><span class=p>],</span> <span class=n>ledwdata</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=p>};</span>
			<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>ledaddr</span> <span class=o>==</span> <span class=mh>2</span><span class=mb>&#39;b10</span> <span class=p>)</span>
				<span class=n>ledout</span><span class=p>[</span><span class=mh>23</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=p>{</span> <span class=n>ledwdata</span><span class=p>[</span><span class=mh>7</span><span class=o>:</span><span class=mh>0</span><span class=p>],</span> <span class=n>ledout</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=p>};</span>
			<span class=k>else</span>
				<span class=n>ledout</span> <span class=o>&lt;=</span> <span class=n>ledout</span><span class=p>;</span>
        <span class=k>end</span>
		<span class=k>else</span> <span class=k>begin</span>
            <span class=n>ledout</span> <span class=o>&lt;=</span> <span class=n>ledout</span><span class=p>;</span>
        <span class=k>end</span>
    <span class=k>end</span>
<span class=k>endmodule</span>


<span class=k>module</span> <span class=n>switchs</span><span class=p>(</span><span class=n>switclk</span><span class=p>,</span> <span class=n>switrst</span><span class=p>,</span> <span class=n>switchread</span><span class=p>,</span> <span class=n>switchcs</span><span class=p>,</span><span class=n>switchaddr</span><span class=p>,</span> <span class=n>switchrdata</span><span class=p>,</span> <span class=n>switch_i</span><span class=p>);</span>
    <span class=k>input</span> <span class=n>switclk</span><span class=p>;</span>			       <span class=c1>//  时钟信号
</span><span class=c1></span>    <span class=k>input</span> <span class=n>switrst</span><span class=p>;</span>			       <span class=c1>//  复位信号
</span><span class=c1></span>    <span class=k>input</span> <span class=n>switchcs</span><span class=p>;</span>			      <span class=c1>//从memorio来的，由低至高位形成的switch片选信号  !!!!!!!!!!!!!!!!!
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>switchaddr</span><span class=p>;</span>		    <span class=c1>//  到switch模块的地址低端  !!!!!!!!!!!!!!!
</span><span class=c1></span>    <span class=k>input</span> <span class=n>switchread</span><span class=p>;</span>			    <span class=c1>//  读信号
</span><span class=c1></span>    <span class=k>output</span> <span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>switchrdata</span><span class=p>;</span>	     <span class=c1>//  送到CPU的拨码开关值注意数据总线只有16根
</span><span class=c1></span>    <span class=k>input</span> <span class=p>[</span><span class=mh>23</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>switch_i</span><span class=p>;</span>		    <span class=c1>//  从板上读的24位开关数据
</span><span class=c1></span>
    <span class=kt>reg</span> <span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>switchrdata</span><span class=p>;</span>
    <span class=k>always</span><span class=p>@(</span><span class=k>negedge</span> <span class=n>switclk</span> <span class=k>or</span> <span class=k>posedge</span> <span class=n>switrst</span><span class=p>)</span> <span class=k>begin</span>
        <span class=k>if</span><span class=p>(</span><span class=n>switrst</span><span class=p>)</span> <span class=k>begin</span>
            <span class=n>switchrdata</span> <span class=o>&lt;=</span> <span class=mh>0</span><span class=p>;</span>
        <span class=k>end</span>
		<span class=c1>//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</span><span class=c1></span>		<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>switchcs</span> <span class=o>&amp;&amp;</span> <span class=n>switchread</span><span class=p>)</span> <span class=k>begin</span>
			<span class=k>if</span><span class=p>(</span><span class=n>switchaddr</span><span class=o>==</span><span class=mh>2</span><span class=mb>&#39;b00</span><span class=p>)</span>
				<span class=n>switchrdata</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>switch_i</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>   <span class=c1>// data output,lower 16 bits non-extended
</span><span class=c1></span>			<span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>switchaddr</span><span class=o>==</span><span class=mh>2</span><span class=mb>&#39;b10</span><span class=p>)</span>
				<span class=n>switchrdata</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=p>{</span> <span class=mh>8&#39;h00</span><span class=p>,</span> <span class=n>switch_i</span><span class=p>[</span><span class=mh>23</span><span class=o>:</span><span class=mh>16</span><span class=p>]</span> <span class=p>};</span> <span class=c1>//data output, upper 8 bits extended with zero
</span><span class=c1></span>			<span class=k>else</span> 
				<span class=n>switchrdata</span> <span class=o>&lt;=</span> <span class=n>switchrdata</span><span class=p>;</span>
        <span class=k>end</span>
		<span class=k>else</span> <span class=k>begin</span>
            <span class=n>switchrdata</span> <span class=o>&lt;=</span> <span class=n>switchrdata</span><span class=p>;</span>
        <span class=k>end</span>
    <span class=k>end</span>
<span class=k>endmodule</span>

<span class=k>module</span> <span class=n>top</span><span class=p>(</span><span class=n>clk</span><span class=p>,</span> <span class=n>rst</span><span class=p>,</span> <span class=n>ioReadCtrl</span><span class=p>,</span> <span class=n>MemreadCtrl</span><span class=p>,</span> <span class=n>iowriteCtrl</span><span class=p>,</span> <span class=n>ledout</span><span class=p>,</span> <span class=n>switch_i</span><span class=p>,</span> <span class=n>MemwriteCtrl</span><span class=p>,</span> 
            <span class=n>register</span><span class=p>,</span> <span class=n>RegAddr</span><span class=p>,</span> <span class=n>RegwriteCtrl</span><span class=p>,</span> <span class=n>RegreadCtrl</span><span class=p>,</span> <span class=n>caddress</span><span class=c1>// );
</span><span class=c1></span>            <span class=p>,</span><span class=n>ioread_data_switch</span><span class=p>,</span> <span class=n>write_data</span><span class=p>,</span> <span class=n>mread_data</span><span class=p>,</span> <span class=n>ledwdata</span><span class=p>);</span>
    <span class=k>input</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>caddress</span><span class=p>;</span>           <span class=c1>// 需要写入的地址，在memoryio中赋值给address
</span><span class=c1></span>    <span class=k>input</span> <span class=n>clk</span><span class=p>,</span> <span class=n>rst</span><span class=p>;</span>
    <span class=k>input</span> <span class=n>ioReadCtrl</span><span class=p>;</span>               <span class=c1>// read IO, from control32
</span><span class=c1></span>    <span class=k>input</span> <span class=n>MemreadCtrl</span><span class=p>;</span>				<span class=c1>// read memory, from control32
</span><span class=c1></span>    <span class=k>input</span> <span class=n>MemwriteCtrl</span><span class=p>;</span>             <span class=c1>// write memory, from control32
</span><span class=c1></span>    <span class=k>input</span> <span class=n>iowriteCtrl</span><span class=p>;</span>              <span class=c1>// write IO, from control32
</span><span class=c1></span>    <span class=k>input</span> <span class=p>[</span><span class=mh>23</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>switch_i</span><span class=p>;</span>		    <span class=c1>//  从板上读的24位开关数据
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>23</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ledout</span><span class=p>;</span>	        <span class=c1>//  向板子上输出的24位LED信号
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>4</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>RegAddr</span><span class=p>;</span>
    <span class=kt>wire</span> <span class=n>SwitchCtrl</span><span class=p>;</span>
    <span class=k>input</span> <span class=n>RegwriteCtrl</span><span class=p>,</span> <span class=n>RegreadCtrl</span><span class=p>;</span>
    <span class=k>output</span> <span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>register</span><span class=p>[</span><span class=mh>0</span><span class=o>:</span><span class=mh>31</span><span class=p>];</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>switchrdata</span><span class=p>;</span>         <span class=c1>//  送到CPU的拨码开关值注意数据总线只有16根
</span><span class=c1></span>    
    <span class=c1>// 辅助信号
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ioread_data_switch</span><span class=p>;</span>
    <span class=k>assign</span> <span class=n>ioread_data_switch</span> <span class=o>=</span> <span class=n>switchrdata</span><span class=p>;</span>
    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>write_data</span><span class=p>;</span>
    <span class=k>output</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>mread_data</span><span class=p>;</span>
    <span class=k>output</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ledwdata</span><span class=p>;</span>

    
    <span class=cm>/* 存储器核心单元 */</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>read_data</span><span class=p>;</span>       <span class=c1>// 从存储单元中获得的数据
</span><span class=c1></span>    <span class=kt>wire</span> <span class=n>LEDCtrl</span><span class=p>;</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>rdata</span><span class=p>;</span>           <span class=c1>// data from memory or IO that want to read into register
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>address</span><span class=p>;</span>         <span class=c1>// address to mAddress and I/O
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ioread_data</span><span class=p>;</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>write_data</span><span class=p>;</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>mread_data</span> <span class=o>=</span> <span class=n>MemreadCtrl</span> <span class=o>?</span> <span class=n>read_data</span> <span class=o>:</span> <span class=p>(</span><span class=n>RegreadCtrl</span> <span class=o>?</span> <span class=n>register</span><span class=p>[</span><span class=n>RegAddr</span><span class=p>]</span> <span class=o>:</span> <span class=n>mread_data</span><span class=p>);</span>
    
    <span class=n>memorio</span> <span class=n>memorioU</span><span class=p>(.</span><span class=n>caddress</span><span class=p>(</span><span class=n>caddress</span><span class=p>),</span>
                     <span class=p>.</span><span class=n>address</span><span class=p>(</span><span class=n>address</span><span class=p>),</span>
                     <span class=p>.</span><span class=n>memread</span><span class=p>(</span><span class=n>MemreadCtrl</span><span class=p>),</span>
                     <span class=p>.</span><span class=n>memwrite</span><span class=p>(</span><span class=n>MemwriteCtrl</span><span class=p>),</span>
                     <span class=p>.</span><span class=n>ioread</span><span class=p>(</span><span class=n>ioReadCtrl</span><span class=p>),</span>
                     <span class=p>.</span><span class=n>iowrite</span><span class=p>(</span><span class=n>iowriteCtrl</span><span class=p>),</span>
                     <span class=p>.</span><span class=n>mread_data</span><span class=p>(</span><span class=n>mread_data</span><span class=p>),</span>
                     <span class=p>.</span><span class=n>ioread_data</span><span class=p>(</span><span class=n>ioread_data</span><span class=p>),</span>
                     <span class=p>.</span><span class=n>wdata</span><span class=p>(</span><span class=n>RegreadCtrl</span> <span class=o>?</span> <span class=n>register</span><span class=p>[</span><span class=n>RegAddr</span><span class=p>]</span> <span class=o>:</span> <span class=mh>32</span><span class=mb>&#39;b0</span><span class=p>),</span>
                     <span class=p>.</span><span class=n>rdata</span><span class=p>(</span><span class=n>rdata</span><span class=p>),</span>
                     <span class=p>.</span><span class=n>write_data</span><span class=p>(</span><span class=n>write_data</span><span class=p>),</span>               <span class=c1>// data to memory or I/O
</span><span class=c1></span>                     <span class=p>.</span><span class=n>LEDCtrl</span><span class=p>(</span><span class=n>LEDCtrl</span><span class=p>),</span>                     <span class=c1>// led 模块的片选信号，高电平有效;
</span><span class=c1></span>                     <span class=p>.</span><span class=n>SwitchCtrl</span><span class=p>(</span><span class=n>SwitchCtrl</span><span class=p>));</span>              <span class=c1>//switch 模块的片选信号，高电平有效    
</span><span class=c1></span>    
    <span class=cm>/* 拨码开关 */</span>
    <span class=cm>/* SwitchCtrl &amp; ioReadCtrl 时可读 */</span>
    <span class=n>switchs</span> <span class=n>switchsU</span><span class=p>(.</span><span class=n>switclk</span><span class=p>(</span><span class=n>clk</span><span class=p>),</span> 
                     <span class=p>.</span><span class=n>switrst</span><span class=p>(</span><span class=n>rst</span><span class=p>),</span> 
                     <span class=p>.</span><span class=n>switchread</span><span class=p>(</span><span class=n>ioReadCtrl</span><span class=p>),</span> 
                     <span class=p>.</span><span class=n>switchcs</span><span class=p>(</span><span class=n>SwitchCtrl</span><span class=p>),</span> 
                     <span class=p>.</span><span class=n>switchaddr</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]),</span> 
                     <span class=p>.</span><span class=n>switchrdata</span><span class=p>(</span><span class=n>switchrdata</span><span class=p>),</span> 
                     <span class=p>.</span><span class=n>switch_i</span><span class=p>(</span><span class=n>switch_i</span><span class=p>));</span>
   
    <span class=cm>/* IO输入的多路选择器 */</span>
    <span class=cm>/* ioReadCtrl 时可读， SwitchCtrl 时读取拨码开关 */</span>
    <span class=n>ioread</span> <span class=n>ioreadU</span><span class=p>(.</span><span class=n>reset</span><span class=p>(</span><span class=n>rst</span><span class=p>),</span>
                   <span class=p>.</span><span class=n>ior</span><span class=p>(</span><span class=n>ioReadCtrl</span><span class=p>),</span>
                   <span class=p>.</span><span class=n>switchctrl</span><span class=p>(</span><span class=n>SwitchCtrl</span><span class=p>),</span>
                   <span class=p>.</span><span class=n>ioread_data</span><span class=p>(</span><span class=n>ioread_data</span><span class=p>),</span>
                   <span class=p>.</span><span class=n>ioread_data_switch</span><span class=p>(</span><span class=n>switchrdata</span><span class=p>));</span>
    
    <span class=cm>/* 存储单元 */</span>
    <span class=n>dmemory32</span> <span class=n>dmemory32</span><span class=p>(.</span><span class=n>read_data</span><span class=p>(</span><span class=n>read_data</span><span class=p>),</span>
                        <span class=p>.</span><span class=n>address</span><span class=p>(</span><span class=n>address</span><span class=p>),</span> 
                        <span class=p>.</span><span class=n>write_data</span><span class=p>(</span><span class=n>write_data</span><span class=p>),</span>
                        <span class=p>.</span><span class=n>Memwrite</span><span class=p>(</span><span class=n>MemwriteCtrl</span><span class=p>),</span>
                        <span class=p>.</span><span class=n>clock</span><span class=p>(</span><span class=n>clk</span><span class=p>));</span>
    
    <span class=cm>/* LED 模块 */</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ledaddr</span> <span class=o>=</span> <span class=n>address</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>];</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ledwdata</span> <span class=o>=</span> <span class=n>ledaddr</span> <span class=o>==</span> <span class=mh>2</span><span class=mb>&#39;b00</span> <span class=o>?</span> <span class=n>mread_data</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>:</span> <span class=n>mread_data</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>16</span><span class=p>];</span>	   <span class=c1>//  写到LED模块的数据，注意数据线只有16根
</span><span class=c1></span>    <span class=n>leds</span> <span class=n>ledsU</span><span class=p>(.</span><span class=n>led_clk</span><span class=p>(</span><span class=n>clk</span><span class=p>),</span> 
               <span class=p>.</span><span class=n>ledrst</span><span class=p>(</span><span class=n>rst</span><span class=p>),</span> 
               <span class=p>.</span><span class=n>ledwrite</span><span class=p>(</span><span class=n>iowriteCtrl</span><span class=p>),</span> 
               <span class=p>.</span><span class=n>ledcs</span><span class=p>(</span><span class=n>LEDCtrl</span><span class=p>),</span> 
               <span class=p>.</span><span class=n>ledaddr</span><span class=p>(</span><span class=n>ledaddr</span><span class=p>),</span>
               <span class=p>.</span><span class=n>ledwdata</span><span class=p>(</span><span class=n>ledwdata</span><span class=p>),</span> 
               <span class=p>.</span><span class=n>ledout</span><span class=p>(</span><span class=n>ledout</span><span class=p>));</span>
    
    <span class=cm>/* 内置寄存器 */</span>
    <span class=kt>reg</span> <span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>register</span><span class=p>[</span><span class=mh>0</span><span class=o>:</span><span class=mh>31</span><span class=p>];</span>
    <span class=k>always</span><span class=p>@(</span><span class=k>posedge</span> <span class=n>clk</span><span class=p>,</span> <span class=k>negedge</span> <span class=n>rst</span><span class=p>)</span> <span class=k>begin</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>rst</span><span class=p>)</span> <span class=k>begin</span>
            <span class=k>for</span> <span class=p>(</span><span class=k>integer</span> <span class=n>cnt</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span> <span class=n>cnt</span> <span class=o>&lt;</span> <span class=mh>32</span><span class=p>;</span> <span class=n>cnt</span> <span class=o>=</span> <span class=n>cnt</span> <span class=o>+</span> <span class=mh>1</span><span class=p>)</span> 
                <span class=n>register</span><span class=p>[</span><span class=n>cnt</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=mh>0</span><span class=p>;</span>
        <span class=k>end</span>
        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>RegwriteCtrl</span> <span class=o>==</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>)</span> <span class=k>begin</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>==</span> <span class=mh>2</span><span class=mb>&#39;b00</span><span class=p>)</span>
                <span class=n>register</span><span class=p>[</span><span class=n>RegAddr</span><span class=p>][</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>ioread_data</span><span class=p>;</span>
            <span class=k>else</span>
                <span class=n>register</span><span class=p>[</span><span class=n>RegAddr</span><span class=p>][</span><span class=mh>31</span><span class=o>:</span><span class=mh>16</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=n>ioread_data</span><span class=p>;</span>
        <span class=k>end</span>
    <span class=k>end</span>
<span class=k>endmodule</span>

</code></pre></td></tr></table></div>
</div>
</div><h3 id=cpu><a href=#cpu class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:cpu class=headings>CPU</a></h3>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=no>`timescale</span> <span class=mh>1</span><span class=n>ns</span> <span class=o>/</span> <span class=mh>1</span><span class=n>ps</span>
<span class=c1>//////////////////////////////////////////////////////////////////////////////////
</span><span class=c1></span><span class=k>module</span> <span class=n>minisys</span><span class=p>(</span><span class=n>rst</span><span class=p>,</span><span class=n>clk</span> <span class=p>,</span><span class=n>switch2N4</span> <span class=p>,</span> <span class=n>led2N4</span><span class=p>);</span>
	<span class=k>input</span> <span class=n>rst</span><span class=p>;</span>               <span class=c1>//板上的Reset信号，低电平复位
</span><span class=c1></span>    <span class=k>input</span> <span class=n>clk</span><span class=p>;</span>               <span class=c1>//板上的100MHz时钟信号
</span><span class=c1></span>    <span class=k>input</span><span class=p>[</span><span class=mh>23</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>switch2N4</span><span class=p>;</span>    <span class=c1>//拨码开关输入
</span><span class=c1></span>    <span class=k>output</span><span class=p>[</span><span class=mh>23</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>led2N4</span><span class=p>;</span>      <span class=c1>//led结果输出到板子
</span><span class=c1></span>

    <span class=kt>wire</span> <span class=n>clock</span><span class=p>;</span>              <span class=c1>//clock: 分频后时钟供给系统
</span><span class=c1></span>    <span class=kt>wire</span> <span class=n>iowrite</span><span class=p>,</span><span class=n>ioread</span><span class=p>;</span>     <span class=c1>//I/O读写信号
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>write_data</span><span class=p>;</span>   <span class=c1>//写RAM或IO的数据
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>rdata</span><span class=p>;</span>        <span class=c1>//读RAM或IO的数据
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ioread_data</span><span class=p>;</span>  <span class=c1>//读IO的数据
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>pc_plus_4</span><span class=p>;</span>    <span class=c1>//PC+4
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>read_data_1</span><span class=p>;</span>  <span class=c1>//
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>read_data_2</span><span class=p>;</span>  <span class=c1>//
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>sign_extend</span><span class=p>;</span>  <span class=c1>//符号扩展
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>add_result</span><span class=p>;</span>   <span class=c1>//
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>alu_result</span><span class=p>;</span>   <span class=c1>//
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>read_data</span><span class=p>;</span>    <span class=c1>//RAM中读取的数据
</span><span class=c1></span>    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>address</span><span class=p>;</span>
<span class=kt>wire</span> <span class=n>alusrc</span><span class=p>;</span>
<span class=kt>wire</span> <span class=n>branch</span><span class=p>;</span>
<span class=kt>wire</span> <span class=n>nbranch</span><span class=p>,</span><span class=n>jmp</span><span class=p>,</span><span class=n>jal</span><span class=p>,</span><span class=n>jrn</span><span class=p>,</span><span class=n>i_format</span><span class=p>;</span>
<span class=kt>wire</span> <span class=n>regdst</span><span class=p>;</span>
<span class=kt>wire</span> <span class=n>regwrite</span><span class=p>;</span>
<span class=kt>wire</span> <span class=n>zero</span><span class=p>;</span>
<span class=kt>wire</span> <span class=n>memwrite</span><span class=p>;</span>
<span class=kt>wire</span> <span class=n>memread</span><span class=p>;</span>
<span class=kt>wire</span> <span class=n>memoriotoreg</span><span class=p>;</span>
<span class=kt>wire</span> <span class=n>memreg</span><span class=p>;</span>
<span class=kt>wire</span> <span class=n>sftmd</span><span class=p>;</span>
<span class=kt>wire</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>aluop</span><span class=p>;</span>
<span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>instruction</span><span class=p>;</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>opcplus4</span><span class=p>;</span>
    <span class=kt>wire</span> <span class=n>ledctrl</span><span class=p>,</span><span class=n>switchctrl</span><span class=p>;</span>
    <span class=kt>wire</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]</span> <span class=n>ioread_data_switch</span><span class=p>;</span>


    

    <span class=n>cpuclk</span> <span class=n>cpuclk</span><span class=p>(</span>
        <span class=p>.</span><span class=n>clk_in1</span><span class=p>(</span><span class=n>clk</span><span class=p>),</span>    <span class=c1>//100MHz
</span><span class=c1></span>        <span class=p>.</span><span class=n>clk_out1</span><span class=p>(</span><span class=n>clock</span><span class=p>)</span>    <span class=c1>//cpuclock
</span><span class=c1></span>    <span class=p>);</span>

    <span class=n>Ifetc32</span> <span class=n>ifetch</span><span class=p>(</span>
        <span class=p>.</span><span class=n>Instruction</span><span class=p>(</span><span class=n>instruction</span><span class=p>),</span>
        <span class=p>.</span><span class=n>PC_plus_4_out</span><span class=p>(</span><span class=n>pc_plus_4</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Add_result</span><span class=p>(</span><span class=n>add_result</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Read_data_1</span><span class=p>(</span><span class=n>read_data_1</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Branch</span><span class=p>(</span><span class=n>branch</span><span class=p>),</span>
        <span class=p>.</span><span class=n>nBranch</span><span class=p>(</span><span class=n>nbranch</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Jmp</span><span class=p>(</span><span class=n>jmp</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Jal</span><span class=p>(</span><span class=n>jal</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Jrn</span><span class=p>(</span><span class=n>jrn</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Zero</span><span class=p>(</span><span class=n>zero</span><span class=p>),</span>
        <span class=p>.</span><span class=n>clock</span><span class=p>(</span><span class=n>clock</span><span class=p>),</span>
        <span class=p>.</span><span class=n>opcplus4</span><span class=p>(</span><span class=n>opcplus4</span><span class=p>),</span>
        <span class=p>.</span><span class=n>reset</span><span class=p>(</span><span class=n>rst</span><span class=p>)</span>
    <span class=p>);</span>
    
    <span class=n>Idecode32</span> <span class=n>idecode</span><span class=p>(</span>
        <span class=p>.</span><span class=n>read_data_1</span><span class=p>(</span><span class=n>read_data_1</span><span class=p>),</span>
        <span class=p>.</span><span class=n>read_data_2</span><span class=p>(</span><span class=n>read_data_2</span><span class=p>),</span>
		<span class=p>.</span><span class=n>Instruction</span><span class=p>(</span><span class=n>instruction</span><span class=p>),</span>
        <span class=p>.</span><span class=n>read_data</span><span class=p>(</span><span class=n>rdata</span><span class=p>),</span>
        <span class=p>.</span><span class=n>ALU_result</span><span class=p>(</span><span class=n>alu_result</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Jal</span><span class=p>(</span><span class=n>jal</span><span class=p>),</span>
        <span class=p>.</span><span class=n>RegWrite</span><span class=p>(</span><span class=n>regwrite</span><span class=p>),</span>
        <span class=p>.</span><span class=n>MemorIOtoReg</span><span class=p>(</span><span class=n>memoriotoreg</span><span class=p>),</span>
        <span class=p>.</span><span class=n>RegDst</span><span class=p>(</span><span class=n>regdst</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Sign_extend</span><span class=p>(</span><span class=n>sign_extend</span><span class=p>),</span>
        <span class=p>.</span><span class=n>clock</span><span class=p>(</span><span class=n>clock</span><span class=p>),</span>
        <span class=p>.</span><span class=n>reset</span><span class=p>(</span><span class=n>rst</span><span class=p>),</span>
        <span class=p>.</span><span class=n>opcplus4</span><span class=p>(</span><span class=n>opcplus4</span><span class=p>)</span>
    <span class=p>);</span>

    
    <span class=n>control32</span> <span class=n>control</span><span class=p>(</span>
        <span class=p>.</span><span class=n>Opcode</span><span class=p>(</span><span class=n>instruction</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>26</span><span class=p>]),</span>
        <span class=p>.</span><span class=n>Function_opcode</span><span class=p>(</span><span class=n>instruction</span><span class=p>[</span><span class=mh>5</span><span class=o>:</span><span class=mh>0</span><span class=p>]),</span>
        <span class=p>.</span><span class=n>Alu_resultHigh</span><span class=p>(</span><span class=n>alu_result</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>10</span><span class=p>]),</span>
        <span class=p>.</span><span class=n>Jrn</span><span class=p>(</span><span class=n>jrn</span><span class=p>),</span>
        <span class=p>.</span><span class=n>RegDST</span><span class=p>(</span><span class=n>regdst</span><span class=p>),</span>
        <span class=p>.</span><span class=n>ALUSrc</span><span class=p>(</span><span class=n>alusrc</span><span class=p>),</span>
        <span class=p>.</span><span class=n>MemorIOtoReg</span><span class=p>(</span><span class=n>memoriotoreg</span><span class=p>),</span>
        <span class=p>.</span><span class=n>RegWrite</span><span class=p>(</span><span class=n>regwrite</span><span class=p>),</span>
        <span class=p>.</span><span class=n>MemRead</span><span class=p>(</span><span class=n>memread</span><span class=p>),</span>
        <span class=p>.</span><span class=n>MemWrite</span><span class=p>(</span><span class=n>memwrite</span><span class=p>),</span>
        <span class=p>.</span><span class=n>IORead</span><span class=p>(</span><span class=n>ioread</span><span class=p>),</span>
        <span class=p>.</span><span class=n>IOWrite</span><span class=p>(</span><span class=n>iowrite</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Branch</span><span class=p>(</span><span class=n>branch</span><span class=p>),</span>
        <span class=p>.</span><span class=n>nBranch</span><span class=p>(</span><span class=n>nbranch</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Jmp</span><span class=p>(</span><span class=n>jmp</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Jal</span><span class=p>(</span><span class=n>jal</span><span class=p>),</span>
        <span class=p>.</span><span class=n>I_format</span><span class=p>(</span><span class=n>i_format</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Sftmd</span><span class=p>(</span><span class=n>sftmd</span><span class=p>),</span>
        <span class=p>.</span><span class=n>ALUOp</span><span class=p>(</span><span class=n>aluop</span><span class=p>)</span>
    <span class=p>);</span>
                      
    <span class=n>Executs32</span> <span class=n>execute</span><span class=p>(</span>
        <span class=p>.</span><span class=n>Read_data_1</span><span class=p>(</span><span class=n>read_data_1</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Read_data_2</span><span class=p>(</span><span class=n>read_data_2</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Sign_extend</span><span class=p>(</span><span class=n>sign_extend</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Function_opcode</span><span class=p>(</span><span class=n>instruction</span><span class=p>[</span><span class=mh>5</span><span class=o>:</span><span class=mh>0</span><span class=p>]),</span>
		<span class=p>.</span><span class=n>Exe_opcode</span><span class=p>(</span><span class=n>instruction</span><span class=p>[</span><span class=mh>31</span><span class=o>:</span><span class=mh>26</span><span class=p>]),</span>
		<span class=p>.</span><span class=n>ALUOp</span><span class=p>(</span><span class=n>aluop</span><span class=p>),</span>
		<span class=p>.</span><span class=n>Shamt</span><span class=p>(</span><span class=n>instruction</span><span class=p>[</span><span class=mh>10</span><span class=o>:</span><span class=mh>6</span><span class=p>]),</span>
		<span class=p>.</span><span class=n>Sftmd</span><span class=p>(</span><span class=n>sftmd</span><span class=p>),</span>
		<span class=p>.</span><span class=n>ALUSrc</span><span class=p>(</span><span class=n>alusrc</span><span class=p>),</span>
		<span class=p>.</span><span class=n>I_format</span><span class=p>(</span><span class=n>i_format</span><span class=p>),</span>
		<span class=p>.</span><span class=n>Zero</span><span class=p>(</span><span class=n>zero</span><span class=p>),</span>
		<span class=p>.</span><span class=n>Jrn</span><span class=p>(</span><span class=n>jrn</span><span class=p>),</span>
		<span class=p>.</span><span class=n>ALU_Result</span><span class=p>(</span><span class=n>alu_result</span><span class=p>),</span>
		<span class=p>.</span><span class=n>Add_Result</span><span class=p>(</span><span class=n>add_result</span><span class=p>),</span>
		<span class=p>.</span><span class=n>PC_plus_4</span><span class=p>(</span><span class=n>pc_plus_4</span><span class=p>)</span>
     <span class=p>);</span>
    
    <span class=n>dmemory32</span> <span class=n>memory</span><span class=p>(</span>
        <span class=p>.</span><span class=n>read_data</span><span class=p>(</span><span class=n>read_data</span><span class=p>),</span>
        <span class=p>.</span><span class=n>address</span><span class=p>(</span><span class=n>address</span><span class=p>),</span>
        <span class=p>.</span><span class=n>write_data</span><span class=p>(</span><span class=n>write_data</span><span class=p>),</span>
        <span class=p>.</span><span class=n>Memwrite</span><span class=p>(</span><span class=n>memwrite</span><span class=p>),</span>
        <span class=p>.</span><span class=n>clock</span><span class=p>(</span><span class=n>clock</span><span class=p>)</span>    <span class=c1>//16.67MHz
</span><span class=c1></span>    <span class=p>);</span>
    <span class=n>memorio</span> <span class=n>memio</span><span class=p>(</span>
        <span class=p>.</span><span class=n>caddress</span><span class=p>(</span><span class=n>alu_result</span><span class=p>),</span>
        <span class=p>.</span><span class=n>address</span><span class=p>(</span><span class=n>address</span><span class=p>),</span>
        <span class=p>.</span><span class=n>memread</span><span class=p>(</span><span class=n>memread</span><span class=p>),</span>
        <span class=p>.</span><span class=n>memwrite</span><span class=p>(</span><span class=n>memwrite</span><span class=p>),</span>
        <span class=p>.</span><span class=n>ioread</span><span class=p>(</span><span class=n>ioread</span><span class=p>),</span>
        <span class=p>.</span><span class=n>iowrite</span><span class=p>(</span><span class=n>iowrite</span><span class=p>),</span>
        <span class=p>.</span><span class=n>mread_data</span><span class=p>(</span><span class=n>read_data</span><span class=p>),</span>
        <span class=p>.</span><span class=n>ioread_data</span><span class=p>(</span><span class=n>ioread_data</span><span class=p>),</span>
        <span class=p>.</span><span class=n>wdata</span><span class=p>(</span><span class=n>read_data_2</span><span class=p>),</span>
        <span class=p>.</span><span class=n>rdata</span><span class=p>(</span><span class=n>rdata</span><span class=p>),</span>
        <span class=p>.</span><span class=n>write_data</span><span class=p>(</span><span class=n>write_data</span><span class=p>),</span>
        <span class=p>.</span><span class=n>LEDCtrl</span><span class=p>(</span><span class=n>ledctrl</span><span class=p>),</span>
        <span class=p>.</span><span class=n>SwitchCtrl</span><span class=p>(</span><span class=n>switchctrl</span><span class=p>)</span>
    <span class=p>);</span>
    <span class=n>ioread</span> <span class=n>multiioread</span><span class=p>(</span>
        <span class=p>.</span><span class=n>reset</span><span class=p>(</span><span class=n>rst</span><span class=p>),</span>
        <span class=p>.</span><span class=n>ior</span><span class=p>(</span><span class=n>ioread</span><span class=p>),</span>
        <span class=p>.</span><span class=n>switchctrl</span><span class=p>(</span><span class=n>switchctrl</span><span class=p>),</span>
        <span class=p>.</span><span class=n>ioread_data</span><span class=p>(</span><span class=n>ioread_data</span><span class=p>),</span>
        <span class=p>.</span><span class=n>ioread_data_switch</span><span class=p>(</span><span class=n>ioread_data_switch</span><span class=p>)</span>
    <span class=p>);</span>
    <span class=n>leds</span> <span class=n>led24</span><span class=p>(</span>
    <span class=p>.</span><span class=n>led_clk</span><span class=p>(</span><span class=n>clock</span><span class=p>),</span>
    <span class=p>.</span><span class=n>ledrst</span><span class=p>(</span><span class=n>rst</span><span class=p>),</span>
    <span class=p>.</span><span class=n>ledwrite</span><span class=p>(</span><span class=n>iowrite</span><span class=p>),</span>
    <span class=p>.</span><span class=n>ledcs</span><span class=p>(</span><span class=n>ledctrl</span><span class=p>),</span>
    <span class=p>.</span><span class=n>ledaddr</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]),</span>
    <span class=p>.</span><span class=n>ledwdata</span><span class=p>(</span><span class=n>write_data</span><span class=p>[</span><span class=mh>15</span><span class=o>:</span><span class=mh>0</span><span class=p>]),</span>
    <span class=p>.</span><span class=n>ledout</span><span class=p>(</span><span class=n>led2N4</span><span class=p>)</span>
    <span class=p>);</span>
    <span class=n>switchs</span> <span class=n>switch24</span><span class=p>(</span>
    <span class=p>.</span><span class=n>switclk</span><span class=p>(</span><span class=n>clock</span><span class=p>),</span>
    <span class=p>.</span><span class=n>switrst</span><span class=p>(</span><span class=n>rst</span><span class=p>),</span>
    <span class=p>.</span><span class=n>switchread</span><span class=p>(</span><span class=n>ioread</span><span class=p>),</span>
    <span class=p>.</span><span class=n>switchcs</span><span class=p>(</span><span class=n>switchctrl</span><span class=p>),</span>
    <span class=p>.</span><span class=n>switchaddr</span><span class=p>(</span><span class=n>address</span><span class=p>[</span><span class=mh>1</span><span class=o>:</span><span class=mh>0</span><span class=p>]),</span>
    <span class=p>.</span><span class=n>switchrdata</span><span class=p>(</span><span class=n>ioread_data_switch</span><span class=p>),</span>
    <span class=p>.</span><span class=n>switch_i</span><span class=p>(</span><span class=n>switch2N4</span><span class=p>)</span>
    <span class=p>);</span>
<span class=k>endmodule</span>


</code></pre></td></tr></table></div>
</div>
</div><h2 id=四-实验结果截图并配以适当的文字说明><a href=#四-实验结果截图并配以适当的文字说明 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:四-实验结果截图并配以适当的文字说明 class=headings>四、 实验结果（截图并配以适当的文字说明）</a></h2>
<h3 id=除法器-1><a href=#除法器-1 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:除法器-1 class=headings>除法器</a></h3>
<figure><img src=https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/1266277654.png>
</figure>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=p>#</span><span class=mh>50</span> <span class=n>resetn</span> <span class=o>=</span> <span class=mh>1</span><span class=p>;</span>
<span class=p>#</span><span class=mh>5</span><span class=n>start</span> <span class=o>=</span> <span class=mh>1</span><span class=p>;</span>
<span class=p>#</span><span class=mh>5</span> <span class=n>start</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
<span class=p>#</span><span class=mh>100</span> <span class=k>begin</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mi>&#39;d24</span><span class=p>;</span><span class=n>b</span> <span class=o>=</span> <span class=mh>4</span><span class=mi>&#39;d11</span><span class=p>;</span><span class=k>end</span>
<span class=p>#</span><span class=mh>5</span><span class=n>start</span> <span class=o>=</span> <span class=mh>1</span><span class=p>;</span>
<span class=p>#</span><span class=mh>5</span> <span class=n>start</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
<span class=p>#</span><span class=mh>100</span> <span class=k>begin</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mi>&#39;d6</span><span class=p>;</span><span class=n>b</span> <span class=o>=</span> <span class=mh>4</span><span class=mi>&#39;d5</span><span class=p>;</span><span class=k>end</span>
<span class=p>#</span><span class=mh>5</span><span class=n>start</span> <span class=o>=</span> <span class=mh>1</span><span class=p>;</span>
<span class=p>#</span><span class=mh>5</span> <span class=n>start</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
<span class=p>#</span><span class=mh>100</span> <span class=k>begin</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mi>&#39;d6</span><span class=p>;</span><span class=n>b</span> <span class=o>=</span> <span class=mh>4</span><span class=mi>&#39;d11</span><span class=p>;</span><span class=k>end</span>
<span class=p>#</span><span class=mh>5</span><span class=n>start</span> <span class=o>=</span> <span class=mh>1</span><span class=p>;</span>
<span class=p>#</span><span class=mh>5</span> <span class=n>start</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
<span class=p>#</span><span class=mh>100</span> <span class=k>begin</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mi>&#39;d134</span><span class=p>;</span><span class=n>b</span> <span class=o>=</span> <span class=mh>4</span><span class=mi>&#39;d5</span><span class=p>;</span><span class=k>end</span>
<span class=p>#</span><span class=mh>5</span><span class=n>start</span> <span class=o>=</span> <span class=mh>1</span><span class=p>;</span>
<span class=p>#</span><span class=mh>5</span> <span class=n>start</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
<span class=p>#</span><span class=mh>100</span> <span class=k>begin</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mi>&#39;d134</span><span class=p>;</span><span class=n>b</span> <span class=o>=</span> <span class=mh>4</span><span class=mi>&#39;d15</span><span class=p>;</span><span class=k>end</span>
<span class=p>#</span><span class=mh>5</span><span class=n>start</span> <span class=o>=</span> <span class=mh>1</span><span class=p>;</span>
<span class=p>#</span><span class=mh>5</span> <span class=n>start</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
<span class=p>#</span><span class=mh>100</span> <span class=k>begin</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mi>&#39;d6</span><span class=p>;</span><span class=n>b</span> <span class=o>=</span> <span class=mh>4</span><span class=mi>&#39;d0</span><span class=p>;</span><span class=k>end</span>
<span class=p>#</span><span class=mh>5</span><span class=n>start</span> <span class=o>=</span> <span class=mh>1</span><span class=p>;</span>
<span class=p>#</span><span class=mh>5</span> <span class=n>start</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span>
<span class=p>#</span><span class=mh>100</span> <span class=nb>$finish</span><span class=p>;</span>


</code></pre></td></tr></table></div>
</div>
</div><h3 id=乘法器-1><a href=#乘法器-1 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:乘法器-1 class=headings>乘法器</a></h3>
<figure><img src=https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/741474208.png>
</figure>
<h3 id=alu-1><a href=#alu-1 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:alu-1 class=headings>ALU</a></h3>
<figure><img src=https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/1462022838.png>
</figure>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=c1>// shift right
</span><span class=c1></span><span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>1000</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0111</span><span class=n>_1111</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0000</span><span class=n>_0010</span><span class=p>;</span>
<span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>1000</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1000</span><span class=n>_0000</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0000</span><span class=n>_0010</span><span class=p>;</span>
<span class=c1>// shift right logically
</span><span class=c1></span><span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>1001</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0111</span><span class=n>_1111</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0000</span><span class=n>_0010</span><span class=p>;</span>
<span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>1001</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1000</span><span class=n>_0000</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0000</span><span class=n>_0010</span><span class=p>;</span>
<span class=c1>// shift left
</span><span class=c1></span><span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>1010</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0111</span><span class=n>_1111</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0000</span><span class=n>_0010</span><span class=p>;</span>
<span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>1010</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1000</span><span class=n>_0000</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0000</span><span class=n>_0010</span><span class=p>;</span>
<span class=c1>// add
</span><span class=c1></span><span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>0000</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0111</span><span class=n>_1111</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0000</span><span class=n>_0001</span><span class=p>;</span>
<span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>0000</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1111</span><span class=n>_1111</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0000</span><span class=n>_0001</span><span class=p>;</span>
<span class=c1>// sub
</span><span class=c1></span><span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>0001</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0000</span><span class=n>_0001</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0111</span><span class=n>_1111</span><span class=p>;</span>
<span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>0001</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0111</span><span class=n>_1111</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0000</span><span class=n>_0001</span><span class=p>;</span>
<span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>0001</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0111</span><span class=n>_1111</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1000</span><span class=n>_0000</span><span class=p>;</span>
<span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>0001</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1000</span><span class=n>_0000</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b0111</span><span class=n>_1111</span><span class=p>;</span>
<span class=c1>// and
</span><span class=c1></span><span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>0100</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1010</span><span class=n>_1010</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1111</span><span class=n>_1111</span><span class=p>;</span>
<span class=c1>// or
</span><span class=c1></span><span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>0101</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1010</span><span class=n>_1010</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1111</span><span class=n>_1111</span><span class=p>;</span>
<span class=c1>// xor
</span><span class=c1></span><span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>0111</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1111</span><span class=n>_0000</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1100</span><span class=n>_1100</span><span class=p>;</span>
<span class=c1>// not
</span><span class=c1></span><span class=p>#</span><span class=mh>10</span> <span class=n>op</span> <span class=o>=</span> <span class=mh>4</span><span class=p>&#39;</span><span class=n>b</span> <span class=mh>0110</span><span class=p>;</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b10101010</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=mh>8</span><span class=mb>&#39;b1111</span><span class=n>_1111</span><span class=p>;</span>


</code></pre></td></tr></table></div>
</div>
</div><h3 id=decoder-1><a href=#decoder-1 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:decoder-1 class=headings>Decoder</a></h3>
<figure><img src=https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/3279812433.png>
</figure>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=p>#</span><span class=mh>20</span>   <span class=n>reset</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
        <span class=p>#</span><span class=mh>20</span>   <span class=k>begin</span> <span class=n>Instruction</span> <span class=o>=</span> <span class=mh>32</span><span class=mb>&#39;b001000</span><span class=n>_00111_00011_1000000000110111</span><span class=p>;</span>  
            <span class=c1>//addi $3,$7,0X8037
</span><span class=c1></span>                    <span class=n>read_data</span> <span class=o>=</span> <span class=mh>32&#39;h00000000</span><span class=p>;</span> 
                    <span class=n>ALU_result</span> <span class=o>=</span> <span class=mh>32&#39;hFFFF803C</span><span class=p>;</span>
                    <span class=n>Jal</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                    <span class=n>RegWrite</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
                    <span class=n>MemtoReg</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                    <span class=n>RegDst</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                    <span class=n>opcplus4</span> <span class=o>=</span> <span class=mh>32&#39;h00000008</span><span class=p>;</span> 
               <span class=k>end</span>
        <span class=p>#</span><span class=mh>20</span>   <span class=k>begin</span> <span class=n>Instruction</span> <span class=o>=</span> <span class=mh>32</span><span class=mb>&#39;b001100</span><span class=n>_00010_00100_1000000010010111</span><span class=p>;</span>  
            <span class=c1>//andi $4,$2,0X8097 
</span><span class=c1></span>                           <span class=n>read_data</span> <span class=o>=</span> <span class=mh>32&#39;h00000000</span><span class=p>;</span> 
                           <span class=n>ALU_result</span> <span class=o>=</span> <span class=mh>32&#39;h00000002</span><span class=p>;</span>
                           <span class=n>Jal</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                           <span class=n>RegWrite</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
                           <span class=n>MemtoReg</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                           <span class=n>RegDst</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                           <span class=n>opcplus4</span> <span class=o>=</span> <span class=mh>32&#39;h0000000c</span><span class=p>;</span> 
                <span class=k>end</span>
        <span class=p>#</span><span class=mh>20</span>   <span class=k>begin</span> <span class=n>Instruction</span> <span class=o>=</span> <span class=mh>32</span><span class=mb>&#39;b000000</span><span class=n>_00000_00001_00101_00010_000000</span><span class=p>;</span>  
            <span class=c1>//sll $5,$1,2
</span><span class=c1></span>                                   <span class=n>read_data</span> <span class=o>=</span> <span class=mh>32&#39;h00000000</span><span class=p>;</span> 
                                   <span class=n>ALU_result</span> <span class=o>=</span> <span class=mh>32&#39;h00000004</span><span class=p>;</span>
                                   <span class=n>Jal</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                                   <span class=n>RegWrite</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
                                   <span class=n>MemtoReg</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                                   <span class=n>RegDst</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
                                   <span class=n>opcplus4</span> <span class=o>=</span> <span class=mh>32&#39;h00000010</span><span class=p>;</span> 
               <span class=k>end</span>
        <span class=p>#</span><span class=mh>20</span>   <span class=k>begin</span> <span class=n>Instruction</span> <span class=o>=</span> <span class=mh>32</span><span class=mb>&#39;b100011</span><span class=n>_00000_00110_0000000100000000</span><span class=p>;</span>  
            <span class=c1>//LW $6,0(0X100)
</span><span class=c1></span>                                          <span class=n>read_data</span> <span class=o>=</span> <span class=mh>32&#39;h0000007B</span><span class=p>;</span> 
                                          <span class=n>ALU_result</span> <span class=o>=</span> <span class=mh>32&#39;h00000054</span><span class=p>;</span>
                                          <span class=n>Jal</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                                          <span class=n>RegWrite</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
                                          <span class=n>MemtoReg</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
                                          <span class=n>RegDst</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                                          <span class=n>opcplus4</span> <span class=o>=</span> <span class=mh>32&#39;h00000014</span><span class=p>;</span> 
               <span class=k>end</span>
        <span class=p>#</span><span class=mh>20</span>   <span class=k>begin</span> <span class=n>Instruction</span> <span class=o>=</span> <span class=mh>32</span><span class=mb>&#39;b000011</span><span class=n>_00000000000000000000000000</span><span class=p>;</span>  
            <span class=c1>//JAL 0000
</span><span class=c1></span>                                          <span class=n>read_data</span> <span class=o>=</span> <span class=mh>32&#39;h00000000</span><span class=p>;</span> 
                                          <span class=n>ALU_result</span> <span class=o>=</span> <span class=mh>32&#39;h00000004</span><span class=p>;</span>
                                          <span class=n>Jal</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
                                          <span class=n>RegWrite</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
                                          <span class=n>MemtoReg</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                                          <span class=n>RegDst</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
                                          <span class=n>opcplus4</span> <span class=o>=</span> <span class=mh>32&#39;h00000018</span><span class=p>;</span> 
               <span class=k>end</span>
        <span class=p>#</span><span class=mh>20</span> <span class=nb>$finish</span><span class=p>;</span>


</code></pre></td></tr></table></div>
</div>
</div><h3 id=执行单元-1><a href=#执行单元-1 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:执行单元-1 class=headings>执行单元</a></h3>
<figure><img src=https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/474079374.png>
</figure>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=p>#</span><span class=mh>200</span> <span class=k>begin</span> <span class=n>Exe_opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b001000</span><span class=p>;</span>  <span class=c1>//addi 
</span><span class=c1></span>    <span class=n>Read_data_1</span> <span class=o>=</span> <span class=mh>32&#39;h00000003</span><span class=p>;</span>		<span class=c1>//r-form rs
</span><span class=c1></span>    <span class=n>Read_data_2</span> <span class=o>=</span> <span class=mh>32&#39;h00000006</span><span class=p>;</span>        <span class=c1>//r-form rt
</span><span class=c1></span>    <span class=n>Sign_extend</span> <span class=o>=</span> <span class=mh>32&#39;hffffff40</span><span class=p>;</span>  
    <span class=n>Function_opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b100000</span><span class=p>;</span>      <span class=c1>//addi 
</span><span class=c1></span>    <span class=n>ALUOp</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b10</span><span class=p>;</span>
    <span class=n>Shamt</span> <span class=o>=</span> <span class=mh>5</span><span class=mb>&#39;b00000</span><span class=p>;</span>
    <span class=n>Sftmd</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>ALUSrc</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
    <span class=n>I_format</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
    <span class=n>PC_plus_4</span> <span class=o>=</span> <span class=mh>32&#39;h00000008</span><span class=p>;</span>
<span class=k>end</span> 
<span class=p>#</span><span class=mh>200</span> <span class=k>begin</span> <span class=n>Exe_opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000000</span><span class=p>;</span>  <span class=c1>//and
</span><span class=c1></span>    <span class=n>Read_data_1</span> <span class=o>=</span> <span class=mh>32&#39;h000000ff</span><span class=p>;</span>        <span class=c1>//r-form rs
</span><span class=c1></span>    <span class=n>Read_data_2</span> <span class=o>=</span> <span class=mh>32&#39;h00000ff0</span><span class=p>;</span>        <span class=c1>//r-form rt
</span><span class=c1></span>    <span class=n>Sign_extend</span> <span class=o>=</span> <span class=mh>32&#39;hffffff40</span><span class=p>;</span>  
    <span class=n>Function_opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b100100</span><span class=p>;</span>      <span class=c1>//and 
</span><span class=c1></span>    <span class=n>ALUOp</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b10</span><span class=p>;</span>
    <span class=n>Shamt</span> <span class=o>=</span> <span class=mh>5</span><span class=mb>&#39;b00000</span><span class=p>;</span>
    <span class=n>Sftmd</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>ALUSrc</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>I_format</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>PC_plus_4</span> <span class=o>=</span> <span class=mh>32&#39;h0000000c</span><span class=p>;</span>
<span class=k>end</span> 
<span class=p>#</span><span class=mh>200</span> <span class=k>begin</span> <span class=n>Exe_opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000000</span><span class=p>;</span>  <span class=c1>//sll
</span><span class=c1></span>    <span class=n>Read_data_1</span> <span class=o>=</span> <span class=mh>32&#39;h00000001</span><span class=p>;</span>        <span class=c1>//r-form rs
</span><span class=c1></span>    <span class=n>Read_data_2</span> <span class=o>=</span> <span class=mh>32&#39;h00000002</span><span class=p>;</span>        <span class=c1>//r-form rt
</span><span class=c1></span>    <span class=n>Sign_extend</span> <span class=o>=</span> <span class=mh>32&#39;hffffff40</span><span class=p>;</span>  
    <span class=n>Function_opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000000</span><span class=p>;</span>      <span class=c1>//sll
</span><span class=c1></span>    <span class=n>ALUOp</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b10</span><span class=p>;</span>
    <span class=n>Shamt</span> <span class=o>=</span> <span class=mh>5</span><span class=mb>&#39;b00011</span><span class=p>;</span>
    <span class=n>Sftmd</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
    <span class=n>ALUSrc</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>I_format</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>PC_plus_4</span> <span class=o>=</span> <span class=mh>32&#39;h00000010</span><span class=p>;</span>
<span class=k>end</span> 
<span class=p>#</span><span class=mh>200</span> <span class=k>begin</span> <span class=n>Exe_opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b001111</span><span class=p>;</span>  <span class=c1>// LUI
</span><span class=c1></span>    <span class=n>Read_data_1</span> <span class=o>=</span> <span class=mh>32&#39;h00000001</span><span class=p>;</span>        <span class=c1>//r-form rs
</span><span class=c1></span>    <span class=n>Read_data_2</span> <span class=o>=</span> <span class=mh>32&#39;h00000002</span><span class=p>;</span>        <span class=c1>//r-form rt
</span><span class=c1></span>    <span class=n>Sign_extend</span> <span class=o>=</span> <span class=mh>32&#39;h00000040</span><span class=p>;</span>  
    <span class=n>Function_opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000000</span><span class=p>;</span>      <span class=c1>//LUI
</span><span class=c1></span>    <span class=n>ALUOp</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b10</span><span class=p>;</span>
    <span class=n>Shamt</span> <span class=o>=</span> <span class=mh>5</span><span class=mb>&#39;b00001</span><span class=p>;</span>
    <span class=n>Sftmd</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>ALUSrc</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
    <span class=n>I_format</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
    <span class=n>PC_plus_4</span> <span class=o>=</span> <span class=mh>32&#39;h00000014</span><span class=p>;</span>
<span class=k>end</span> 
<span class=p>#</span><span class=mh>200</span> <span class=k>begin</span> <span class=n>Exe_opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000100</span><span class=p>;</span>  <span class=c1>// BEQ
</span><span class=c1></span>    <span class=n>Read_data_1</span> <span class=o>=</span> <span class=mh>32&#39;h00000001</span><span class=p>;</span>        <span class=c1>//r-form rs
</span><span class=c1></span>    <span class=n>Read_data_2</span> <span class=o>=</span> <span class=mh>32&#39;h00000001</span><span class=p>;</span>        <span class=c1>//r-form rt
</span><span class=c1></span>    <span class=n>Sign_extend</span> <span class=o>=</span> <span class=mh>32&#39;h00000004</span><span class=p>;</span>  
    <span class=n>Function_opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000100</span><span class=p>;</span>      <span class=c1>//LUI
</span><span class=c1></span>    <span class=n>ALUOp</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b01</span><span class=p>;</span>
    <span class=n>Shamt</span> <span class=o>=</span> <span class=mh>5</span><span class=mb>&#39;b00000</span><span class=p>;</span>
    <span class=n>Sftmd</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>ALUSrc</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>I_format</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>PC_plus_4</span> <span class=o>=</span> <span class=mh>32&#39;h00000018</span><span class=p>;</span>
<span class=k>end</span> 
<span class=p>#</span><span class=mh>200</span> <span class=k>begin</span>    <span class=c1>// SLT
</span><span class=c1></span>    <span class=n>Read_data_1</span> <span class=o>=</span> <span class=mh>32&#39;h00000001</span><span class=p>;</span>        <span class=c1>// r-form rs
</span><span class=c1></span>    <span class=n>Read_data_2</span> <span class=o>=</span> <span class=mh>32&#39;h00000011</span><span class=p>;</span>        <span class=c1>// r-form rt
</span><span class=c1></span>    <span class=n>Sign_extend</span> <span class=o>=</span> <span class=mh>32&#39;h00000004</span><span class=p>;</span>  
    <span class=n>Function_opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b101010</span><span class=p>;</span>      <span class=c1>// SLT 2a
</span><span class=c1></span>    <span class=n>ALUOp</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b10</span><span class=p>;</span>
    <span class=n>Shamt</span> <span class=o>=</span> <span class=mh>5</span><span class=mb>&#39;b00000</span><span class=p>;</span>
    <span class=n>Sftmd</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>ALUSrc</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>I_format</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=n>PC_plus_4</span> <span class=o>=</span> <span class=mh>32&#39;h00000022</span><span class=p>;</span>
<span class=k>end</span>
<span class=p>#</span><span class=mh>200</span> <span class=nb>$finish</span><span class=p>;</span>


</code></pre></td></tr></table></div>
</div>
</div><h3 id=取指单元-1><a href=#取指单元-1 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:取指单元-1 class=headings>取指单元</a></h3>
<figure><img src=https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/998898828.png>
</figure>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=k>initial</span> <span class=k>begin</span>
    <span class=p>#</span><span class=mh>10</span>   <span class=n>reset</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=p>#</span><span class=mh>10</span>   <span class=n>Jal</span> <span class=o>=</span> <span class=mh>1</span><span class=p>;</span>
    <span class=p>#</span><span class=mh>10</span>   <span class=k>begin</span> <span class=n>Jrn</span> <span class=o>=</span> <span class=mh>1</span><span class=p>;</span><span class=n>Jal</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span> <span class=n>Read_data_1</span> <span class=o>=</span> <span class=mh>32&#39;h0000019c</span><span class=p>;</span><span class=k>end</span><span class=p>;</span>
    <span class=p>#</span><span class=mh>10</span>   <span class=k>begin</span> <span class=n>Jrn</span> <span class=o>=</span> <span class=mh>0</span><span class=p>;</span><span class=n>Branch</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span> <span class=n>Zero</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span> <span class=n>Add_result</span> <span class=o>=</span> <span class=mh>32&#39;h00000002</span><span class=p>;</span><span class=k>end</span><span class=p>;</span>       
    <span class=p>#</span><span class=mh>10</span>   <span class=k>begin</span> <span class=n>Branch</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span> <span class=n>Zero</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span> <span class=k>end</span><span class=p>;</span>
    <span class=p>#</span><span class=mh>10</span> <span class=nb>$finish</span><span class=p>;</span>
<span class=k>end</span>


</code></pre></td></tr></table></div>
</div>
</div><h3 id=控制单元-1><a href=#控制单元-1 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:控制单元-1 class=headings>控制单元</a></h3>
<figure><img src=https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/2745532257.png>
</figure>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=k>initial</span> <span class=k>begin</span>
    <span class=p>#</span><span class=mh>20</span>     <span class=n>Function_opcode</span>  <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b001000</span><span class=p>;</span>               <span class=c1>// JR
</span><span class=c1></span>    <span class=p>#</span><span class=mh>20</span>    <span class=n>Opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b001000</span><span class=p>;</span>                         <span class=c1>//  ADDI
</span><span class=c1></span>    <span class=p>#</span><span class=mh>20</span>    <span class=n>Opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b100011</span><span class=p>;</span>                         <span class=c1>//  LW
</span><span class=c1></span>    <span class=p>#</span><span class=mh>20</span>    <span class=n>Opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b101011</span><span class=p>;</span>                         <span class=c1>//  SW
</span><span class=c1></span>    <span class=p>#</span><span class=mh>20</span>    <span class=n>Opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000100</span><span class=p>;</span>                         <span class=c1>//  BEQ
</span><span class=c1></span>    <span class=p>#</span><span class=mh>20</span>    <span class=n>Opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000101</span><span class=p>;</span>                         <span class=c1>//  BNE
</span><span class=c1></span>    <span class=p>#</span><span class=mh>20</span>    <span class=n>Opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000010</span><span class=p>;</span>                         <span class=c1>//  JMP
</span><span class=c1></span>    <span class=p>#</span><span class=mh>20</span>    <span class=n>Opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000011</span><span class=p>;</span>                         <span class=c1>//  JAL
</span><span class=c1></span>    <span class=p>#</span><span class=mh>20</span>    <span class=k>begin</span> <span class=n>Opcode</span> <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000000</span><span class=p>;</span> <span class=n>Function_opcode</span>  <span class=o>=</span> <span class=mh>6</span><span class=mb>&#39;b000010</span><span class=p>;</span> <span class=k>end</span><span class=p>;</span><span class=c1>//  SRL
</span><span class=c1></span>    <span class=p>#</span><span class=mh>20</span> <span class=nb>$finish</span><span class=p>;</span>
<span class=k>end</span>


</code></pre></td></tr></table></div>
</div>
</div><h3 id=memoryio-1><a href=#memoryio-1 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:memoryio-1 class=headings>MemoryIO</a></h3>
<figure><img src=https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/2098947473.png>
</figure>
<div class=highlight><div class=chroma>
<div class=table-container><table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-verilog data-lang=verilog><span class=k>fork</span>
    <span class=p>#</span><span class=mh>10</span>  <span class=k>begin</span> <span class=c1>// 取消复位信号，关闭所有控制信号
</span><span class=c1></span>        <span class=n>rst</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
        <span class=n>ioReadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
        <span class=n>iowriteCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
        <span class=n>MemreadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
        <span class=n>MemwriteCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
        <span class=n>RegreadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
        <span class=n>RegwriteCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=k>end</span>
    <span class=p>#</span><span class=mh>200</span> <span class=k>begin</span> <span class=c1>//  在200ns时读取 switchs 的数据，将其写入reg $1的低24bit；
</span><span class=c1></span>        <span class=c1>// 控制信号
</span><span class=c1></span>        <span class=n>ioReadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>  <span class=c1>// 读取 switchs 
</span><span class=c1></span>        <span class=n>MemreadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span> <span class=c1>// 读取 switchs 
</span><span class=c1></span>        <span class=n>RegwriteCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span><span class=c1>// 写入寄存器
</span><span class=c1></span>        <span class=c1>// 输入信号
</span><span class=c1></span>        <span class=n>switch_i</span> <span class=o>=</span> <span class=mh>24</span><span class=mb>&#39;b111111111111111111111111</span><span class=p>;</span> <span class=c1>// 拨码开关
</span><span class=c1></span>        <span class=n>RegAddr</span> <span class=o>=</span> <span class=mh>5</span><span class=mb>&#39;b00001</span><span class=p>;</span>     <span class=c1>// 寄存器地址
</span><span class=c1></span>        <span class=c1>// 辅助信号
</span><span class=c1></span>        <span class=n>caddress</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b00</span><span class=p>;</span>     <span class=c1>// 读取后16位
</span><span class=c1></span>    <span class=k>end</span>
    <span class=p>#</span><span class=mh>220</span> <span class=n>caddress</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b10</span><span class=p>;</span>    <span class=c1>// 读取前8位
</span><span class=c1></span>    <span class=p>#</span><span class=mh>240</span> <span class=k>begin</span> <span class=c1>// 控制信号关闭
</span><span class=c1></span>        <span class=n>ioReadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
        <span class=n>MemreadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span> 
        <span class=n>RegwriteCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=k>end</span> 
    <span class=p>#</span><span class=mh>400</span> <span class=k>begin</span>  <span class=c1>// 在400ns时读取$1上的数据，将其写入memory 地址为1的存储单元；
</span><span class=c1></span>        <span class=c1>// 控制信号
</span><span class=c1></span>        <span class=n>RegreadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span> <span class=c1>// 能够读取 register 的数据
</span><span class=c1></span>        <span class=n>MemwriteCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span><span class=c1>// 能够写入 memory
</span><span class=c1></span>        <span class=c1>// 输入信号
</span><span class=c1></span>        <span class=n>RegAddr</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>     <span class=c1>// 寄存器地址
</span><span class=c1></span>        <span class=n>caddress</span> <span class=o>=</span> <span class=mh>32</span><span class=mb>&#39;b1</span><span class=p>;</span>   <span class=c1>// 写入地址
</span><span class=c1></span>    <span class=k>end</span>
    <span class=p>#</span><span class=mh>500</span> <span class=k>begin</span> <span class=c1>// 控制信号关闭
</span><span class=c1></span>        <span class=n>RegreadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
        <span class=n>MemwriteCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=k>end</span>
    <span class=p>#</span><span class=mh>600</span> <span class=k>begin</span> <span class=c1>// 在600ns读取memory 地址为1的存储单元的值
</span><span class=c1></span>        <span class=n>MemreadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
    <span class=k>end</span>
    <span class=p>#</span><span class=mh>700</span> <span class=k>begin</span> <span class=c1>// 控制信号关闭
</span><span class=c1></span>        <span class=n>MemreadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=k>end</span>
    <span class=p>#</span><span class=mh>800</span> <span class=k>begin</span> <span class=c1>// 在800ns时将其写入到 led 作为输出；
</span><span class=c1></span>        <span class=c1>// 控制信号
</span><span class=c1></span>        <span class=n>iowriteCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>
        <span class=n>ioReadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b1</span><span class=p>;</span>  <span class=c1>// LEDCtrl 使能信号
</span><span class=c1></span>        <span class=c1>// 辅助信号
</span><span class=c1></span>        <span class=n>caddress</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b00</span><span class=p>;</span>     <span class=c1>// 写入后16位   
</span><span class=c1></span>    <span class=k>end</span>
    <span class=p>#</span><span class=mh>840</span> <span class=n>caddress</span> <span class=o>=</span> <span class=mh>2</span><span class=mb>&#39;b10</span><span class=p>;</span> <span class=c1>// 写入前8位
</span><span class=c1></span>    <span class=p>#</span><span class=mh>900</span> <span class=k>begin</span> <span class=c1>// 控制信号关闭
</span><span class=c1></span>        <span class=n>iowriteCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
        <span class=n>ioReadCtrl</span> <span class=o>=</span> <span class=mh>1</span><span class=mb>&#39;b0</span><span class=p>;</span>
    <span class=k>end</span>
    <span class=p>#</span><span class=mh>1000</span> <span class=nb>$finish</span><span class=p>;</span>
<span class=k>join</span>


</code></pre></td></tr></table></div>
</div>
</div><h3 id=cpu-1><a href=#cpu-1 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:cpu-1 class=headings>CPU</a></h3>
<figure><img src=https://image-hosting.zhangjc.tech/ghost/content/images/2019/06/942749760.png>
</figure>
<h2 id=五-实验分析遇到的问题以及解决方案><a href=#五-实验分析遇到的问题以及解决方案 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:五-实验分析遇到的问题以及解决方案 class=headings>五、 实验分析（遇到的问题以及解决方案）</a></h2>
<ol>
<li>创建RAM时不能勾选带使能信号 不然仿真的时候会一直写不进去</li>
<li>给RAM增加IO接口时 需要把原来的<code>MemtoReg</code>改成<code>MemorIOtoReg</code> 而不是简单的新增</li>
<li><code>IORead</code>/<code>IOWrite</code>/<code>MemRead</code>基本上就是照抄上面给的<code>MemWrite</code>示例 但是要稍微改一下判定条件</li>
<li>注意到 Led和switch都是24bit 但是我们每次只能读取16bit 所以需要自己在仿真过程中手动拼接（读取/写入都是同理）</li>
<li><code>ledaddr</code>/<code>switchaddr</code> 决定了是前8bit还是后16bit 可以直接用地址的最后两位 而不需要自己手动输入</li>
<li><code>MemorIO</code>实际上就是一个转发器 决定到底是用IO还是用mem处理 （也可以把<code>ioread</code>看作一个输入设备的接口/父类） 最好在纸上整理好信号走向在开始写模拟</li>
<li>模拟的时候 寄存器并不需要真的把之前的模块放进来 可以自己用一个<code>reg</code>模拟一下</li>
<li>仿真CPU需要注意很多细节，由于没有部分指令分解的<code>wire</code>不存在，不推荐使用<code>block design</code></li>
<li>CPU设计程序文件时，在汇编层级的延时处理需要结合波形图（跳转，算术运算等所需的时钟周期），确定最终的循环次数</li>
</ol>
<h2 id=六-实验小结与反馈><a href=#六-实验小结与反馈 class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:六-实验小结与反馈 class=headings>六、 实验小结与反馈</a></h2>
<p>最后一周太刺激了！！！</p>
<p>感觉最后<code>MemoryIO</code>的课件没有前面几个顺手，资料不是很全的感觉。</p>
<p>另外也许课件里的sim文件统一采用<code>fork</code> <code>join</code>会更便于观察？</p>
<p>清华（还是北大）的课件好像实现了带有分支预测的CPU，或许我们也可以试一试</p>
<p>检查作业的学助和老师辛苦了。</p>
</div>
</article>
<div class=related-posts>
<h2 class=related-title>相关文章：<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6.0-12-5.4-12-12v-92h-92c-6.6.0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6.0 12 5.4 12 12v92h92c6.6.0 12 5.4 12 12v56z"/></svg></h2>
<ul class=related-list>
<li class=related-item>
<a href=/learn-linux-link/ class=related-link>深入理解 Linux 链接</a>
</li>
<li class=related-item>
<a href=/archives-604/ class=related-link>MIT6.828 | Lec6: Virtual Memory - 1</a>
</li>
<li class=related-item>
<a href=/archives-602/ class=related-link>MIT6.828 | hw5: xv6 system calls 【待填坑 dup2】</a>
</li>
<li class=related-item>
<a href=/archives-601/ class=related-link>MIT6.828 | Lec 5: Isolation mechanisms</a>
</li>
<li class=related-item>
<a href=/archives-592/ class=related-link>MIT6.828 | Lec4: Shell & OS organization</a>
</li>
</ul>
</div>
<div class=post-tags>
<a href=/tags/note/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>note</a>
</div>
<footer class=minimal-footer>
<div class=post-tag><a href=/tags/note/ rel=tag class=post-tag-link>#note</a></div>
<div class=post-category>
<a href=/tech/ class="post-category-link active">tech</a>
</div>
</footer>
<ul class=post-nav>
<li class=post-nav-prev>
<a href=/archives-488/ rel=prev>&lt; 美化 | 为 WSL 配置 Hyper.js + Oh My ZSH + Angoster主题</a>
</li>
<li class=post-nav-next>
<a href=/archives-462/ rel=next>数据库 | 数据库系统概念及架构-Database System Concepts and Architecture ></a>
</li>
</ul>
</div>
</main>
<div id=back-to-top class=back-to-top>
<a href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a>
</div>
<footer id=footer class=footer>
<div class=footer-inner>
<div class=site-info>©&nbsp;2019–2021&nbsp;&nbsp;Jiachen</div><div class=site-copyright><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a></div>
</div>
</footer>
</div>
<script>'serviceWorker'in navigator&&window.addEventListener('load',function(){navigator.serviceWorker.register('/sw.js')})</script>
<script src=https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js></script>
<script>mediumZoom(document.querySelectorAll('div.post-body img'),{background:'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'})</script>
<script src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js type=module defer></script>
</body>
</html>